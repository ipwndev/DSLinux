<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 5. The 500-User Office</title><link rel="stylesheet" href="samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.66.1"><link rel="start" href="index.html" title="Samba-3 by Example"><link rel="up" href="index.html" title="Samba-3 by Example"><link rel="prev" href="secure.html" title="Chapter 4. Secure Office Networking"><link rel="next" href="happy.html" title="Chapter 6. Making Happy Users"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 5. The 500-User Office</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="secure.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="happy.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="Big500users"></a>Chapter 5. The 500-User Office</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="Big500users.html#id2545764">Introduction</a></span></dt><dd><dl><dt><span class="sect2"><a href="Big500users.html#id2545818">Assignment Tasks</a></span></dt></dl></dd><dt><span class="sect1"><a href="Big500users.html#id2545918">Dissection and Discussion</a></span></dt><dd><dl><dt><span class="sect2"><a href="Big500users.html#id2545948">Technical Issues</a></span></dt><dt><span class="sect2"><a href="Big500users.html#id2546152">Political Issues</a></span></dt></dl></dd><dt><span class="sect1"><a href="Big500users.html#id2546170">Implementation</a></span></dt><dd><dl><dt><span class="sect2"><a href="Big500users.html#ch5-dnshcp-setup">Installation of DHCP, DNS, and Samba Control Files</a></span></dt><dt><span class="sect2"><a href="Big500users.html#id2546900">Server Preparation  All Servers</a></span></dt><dt><span class="sect2"><a href="Big500users.html#id2547452">Server Specific Preparation</a></span></dt><dt><span class="sect2"><a href="Big500users.html#ch5-procstart">Process Startup Configuration</a></span></dt><dt><span class="sect2"><a href="Big500users.html#ch5wincfg">Windows Client Configuration</a></span></dt><dt><span class="sect2"><a href="Big500users.html#id2550973">Key Points Learned</a></span></dt></dl></dd><dt><span class="sect1"><a href="Big500users.html#id2551027">Questions and Answers</a></span></dt></dl></div><p>
	The Samba-3 networking you explored in the previous chapter covers the finer points of 
	configuration of peripheral services such as DHCP and DNS, and WINS. You experienced
	implementation of a simple configuration of the services that are important adjuncts 
	to successful deployment of Samba. 
	</p><p>
	An analysis of the history of postings to the Samba mailing list easily demonstrates 
	that the two most prevalent Samba problem areas are:
	</p><div class="itemizedlist"><ul type="disc"><li><p>
		Defective resolution of a NetBIOS name to its IP address
		</p></li><li><p>
		Printing problems
		</p></li></ul></div><p>
	The next chapter deals with more complex printing configurations. The exercises
	so far in this book have focused on implementation of the simplest printing processes
	involving  no print job processing intelligence. In this chapter, you maintain 
	that same approach to printing, but in the following chapter, there is an opportunity 
	to make printing more complex for the administrator while making it easier for the user.
	</p><p><a class="indexterm" name="id2545700"></a><a class="indexterm" name="id2545707"></a><a class="indexterm" name="id2545715"></a>
	The previous chapter demonstrates operation of a DHCP server and a DNS server, 
	as well as a central WINS server. You validated the operation of these services and
	saw an effective implementation of a Samba Domain Controller using the 
	<i class="parameter"><tt>tdbsam</tt></i> passdb backend.
	</p><p>
	The objective of this chapter is to introduce more complex techniques that can be used to
	improve manageability of Samba as networking needs grow. In this chapter, you implement
	a distributed DHCP server environment, a distributed DNS server arrangement, a centralized
	WINS server, and a centralized Samba Domain Controller.
	</p><p>
	A note of caution is important regarding the Samba configuration that is used in this
	chapter. The use of a single Domain Controller on a routed, multi-segment network is 
	a poor design choice that leads to potential network user complaints. As stated 
	in the paragraph above, the objective in this chapter is to demonstrate some successful 
	techniques in deployment and configuration management. This should be viewed as a 
	foundation chapter for complex Samba deployments.
	</p><p>
	As you master the techniques presented here, you may find much better methods to 
	improve network management and control while reducing human resource overheads.
	You should take the opportunity to innovate and expand on the methods presented 
	here and explore them to the fullest.
	</p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2545764"></a>Introduction</h2></div></div></div><p>
	Business continues to go well for Abmas. Mr. Meany is driving your success and the
	network continues to grow thanks to the hard work Christine has done. You recently
	hired Stanley Soroka as Manager of Information Systems. Christine recommended Stan
	to the role. She told you Stan is so good at handling Samba that he can make a cast
	iron rocking horse that is embedded in concrete kick like a horse at a rodeo. You
	need skills like his. Christine and Stan get along just fine. Let's see what 
	you can get out of this pair as they plot the next generation networks.
	</p><p>
	Ten months ago Abmas closed an acquisition of a property insurance business. The
	founder lost interest in the business and decided to sell it to Mr. Meany.
	Because they were former university classmates, the purchase was concluded with mutual assent. The
	acquired business is located at the other end of town in much larger facilities.
	The old Abmas building has become too small. Located on the same campus as the
	newly acquired business are two empty buildings that are ideal to provide
	Abmas with opportunity for growth.
	</p><p>
	Abmas has now completed the purchase of the two empty buildings and you are
	to install a new network and relocate staff in nicely furnished new facilities.
	The new network is to be used to fully integrate company operations. You have
	decided to locate the new network operations control center in the larger building
	in which the insurance group is located to take advantage of an ideal floor space
	and to allow Stan and Christine to fully stage the new network and test it before
	it is rolled out. Your strategy is to complete the new network so that it
	is ready for operation when the old office moves into the new premises.
	</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2545818"></a>Assignment Tasks</h3></div></div></div><p>
		The acquired business had 280 network users. The old Abmas building housed
		220 network users in unbelievably cramped conditions. The network that
		initially served 130 users now handles 220 users quite well.
		</p><p>
		The two businesses will be fully merged to create a single campus company.
		The Property Insurance Group (PIG) houses 300 employees, the new Accounting
		Services Group (ASG) will be in a small building (BLDG1) that houses 50 
		employees, and the Financial Services Group (FSG) will be housed in a large
		building that has capacity for growth (BLDG2). Building 2 houses 150 network
		users.
		</p><p>
		You have decided to connect the building using fiber optic links between new
		routers. As a backup, the buildings are interconnected using line-of-sight
		high-speed infrared facilities. The infrared connection provides a
		secondary route to be used during periods of high demand for network
		bandwidth.
		</p><p>
		The Internet gateway is upgraded to 15 Megabit/sec service. Your ISP
		provides on your premises a fully managed Cisco PIX firewall. You no longer need
		to worry about firewall facilities on your network.
		</p><p>
		Stanley Soroka and Christine have purchased new server hardware. Christine wants to
		roll out a network that has whistles and bells. Stan wants to start off with
		a simple to manage, not-too-complex network. He is of the opinion that network
		users need to be gradually introduced to new features and capabilities and not
		rushed into an environment that may cause disorientation and loss of productivity.
		</p><p>
		Your intrepid network team has decided to implement a network configuration
		that closely mirrors the successful system you installed in the old Abmas building.
		The new network infrastructure is owned by Abmas, but all desktop systems
		are being procured through a new out-source services and leasing company. Under
		the terms of a deal with Mr. M. Proper (CEO), DirectPointe Inc., provides
		all desktop systems and includes full level-one Help desk support for 
		a flat per-machine monthly fee. The deal allows you to add workstations on demand.
		This frees Stan and Christine to deal with deeper issues as they emerge and 
		permits Stan to work on creating new future value-added services.
		</p><p>
		DirectPointe Inc. receives from you a new standard desktop configuration
		every four months. They automatically roll that out to each desktop system.
		You must keep DirectPointe informed of all changes.
		</p><p><a class="indexterm" name="id2545890"></a>
		The new network has a single Samba Domain Controller (PDC) located in the
		Network Operation Center (NOC). Buildings 1 and 2 each have a local server
		for local application servicing. It is a Domain Member. The new system
		uses the <i class="parameter"><tt>tdbsam</tt></i> passdb backend.
		</p><p>
		Printing is based on raw pass-through facilities as it has been used so far.
		All printer drivers are installed on the desktop and notebook computers.
		</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2545918"></a>Dissection and Discussion</h2></div></div></div><p>
	<a class="indexterm" name="id2545926"></a>
	The example you are building in this chapter is an example of a network design that works,
	but this does not make it a design that is recommended. As a general rule, there should
	be at least one Backup Domain Controller per 150 Windows network clients. The principle behind
	this recommendation is the fact that correct operation of MS Windows clients requires rapid
	network response to all SMB/CIFS requests. The same rule says that if there are more than
	50 clients per Domain Controller they are too busy to service requests. Let's put such
	rules aside and recognize that network load affects the integrity of Domain Controller
	responsiveness. This network will have 500 clients serviced by one central Domain
	Controller. This is not a good omen for user satisfaction. You, of course, address this
	very soon (see next chapter).
	</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2545948"></a>Technical Issues</h3></div></div></div><p>
		Stan has talked you into a horrible compromise, but it is addressed. Just make
		certain that the performance of this network is well validated before going live.
		</p><p>
		Design decisions made in this design include:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
			<a class="indexterm" name="id2545969"></a>
			<a class="indexterm" name="id2545976"></a>
			<a class="indexterm" name="id2545983"></a>
			A single Primary Domain Controller (PDC) is being implemented. This limitation
			is based on the choice not to use LDAP. Many network administrators fear using
			LDAP based on the perceived complexity of implementation and management of an
			LDAP-based backend for all user identity management as well as to store network	
			access credentials.
			</p></li><li><p>
			<a class="indexterm" name="id2546000"></a>
			<a class="indexterm" name="id2546007"></a>
			Because of the refusal to use an LDAP (ldapsam) passdb backend at this time,
			the only choice that makes sense with 500 users is to use the tdbsam passwd backend.
			This type of backend is not receptive to replication to Backup Domain Controllers.
			If the tdbsam <tt class="filename">passdb.tdb</tt> file is replicated to Backup Domain
			Controllers (BDCs) using <span><b class="command">rsync</b></span>, there are two potential problems:
			1) Data that is in memory but not yet written to disk will not be replicated,
			and 2) Domain Member machines periodically change the secret machine password. When
			this happens, there is no mechanism to return the changed password to the PDC.
			</p></li><li><p>
			All Domain user, group, and machine accounts are managed on the PDC. This makes
			for a simple mode of operation, but has to be balanced with network performance and
			integrity of operations considerations.
			</p></li><li><p>
			<a class="indexterm" name="id2546048"></a>
			A single central WINS server is being used. The PDC is also the WINS server.
			Any attempt to operate a routed network without a WINS server while using NetBIOS
			over TCP/IP protocols does not work unless on each client the name resolution
			entries for the PDC are added to the <tt class="filename">LMHOSTS</tt>. This file is
			normally located on the Windows XP Professional client in the 
			<tt class="filename">C:\WINDOWS\SYSTEM32\ETC\DRIVERS</tt> directory.
			</p></li><li><p>
			At this time the Samba WINS database is not capable of being replicated. That is
			why a single WINS server is being implemented. This should work without a problem.
			</p></li><li><p>
			<a class="indexterm" name="id2546085"></a>
			Backup Domain Controllers make use of <span><b class="command">winbindd</b></span> to provide
			access to Domain security credentials for file system access and object storage.
			</p></li><li><p>
			<a class="indexterm" name="id2546105"></a>
			<a class="indexterm" name="id2546114"></a>
			Configuration of Windows XP Professional clients is achieved using DHCP. Each
			subnet has its own DHCP server. Backup DHCP serving is provided by one
			alternate DHCP server. This necessitates enabling of the DHCP Relay agent on
			all routers. The DHCP Relay agent must be programmed to pass DHCP Requests from the
			network directed at the backup DHCP server.
			</p></li><li><p>
			All network users are granted the ability to print to any printer that is network
			attached. All printers are available from each server. Print jobs that are spooled
			to a printer that is not on the local network segment are automatically routed to
			the print spooler that is in control of that printer. The specific details of how this
			might be done is demonstrated for one example only.
			</p></li><li><p>
			The network address and sub-netmask chosen provide 1022 usable IP addresses in
			each subnet. If in the future more addresses are required, it would make sense
			to add further subnets rather than change addressing.
			</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2546152"></a>Political Issues</h3></div></div></div><p>
		This case gets close to the real world. You and I know the right way to implement
		Domain Control. Politically, we have to navigate a mine field. In this case, the need is to
		get the PDC rolled out in compliance with expectations and also to be ready to save the day
		by having the real solution ready before it is needed. That real solution is presented in
		the next chapter.
		</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2546170"></a>Implementation</h2></div></div></div><p>
	The following configuration process begins following installation of Red Hat Fedora Core2 on the
	three servers shown in the network topology diagram in <a href="Big500users.html#chap05net" title="Figure 5.1. Network Topology  500 User Network Using tdbsam passdb backend.">???</a>. You have
	selected hardware that is appropriate to the task.
	</p><div class="figure"><a name="chap05net"></a><p class="title"><b>Figure 5.1. Network Topology  500 User Network Using tdbsam passdb backend.</b></p><div class="mediaobject"><img src="images/chap5-net.png" width="270" alt="Network Topology 500 User Network Using tdbsam passdb backend."></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ch5-dnshcp-setup"></a>Installation of DHCP, DNS, and Samba Control Files</h3></div></div></div><p>
	Carefully install the configuration files into the correct locations as shown in 
	<a href="Big500users.html#ch5-filelocations" title="Table 5.1. Domain: MEGANET, File Locations for Servers">???</a>. You should validate that the full file path is
	correct as shown.
	</p><p>
	The abbreviation shown in this table as <tt class="constant">{VLN}</tt> means
	the directory location beginning with <tt class="filename">/var/lib/named</tt>.
	</p><div class="table"><a name="ch5-filelocations"></a><p class="title"><b>Table 5.1. Domain: <tt class="constant">MEGANET</tt>, File Locations for Servers</b></p><table summary="Domain: MEGANET, File Locations for Servers" border="1"><colgroup><col align="left"><col align="left"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th colspan="2" align="center">File Information</th><th colspan="3" align="center">Server Name</th></tr><tr><th align="center">Source</th><th align="center">Target Location</th><th align="center">MASSIVE</th><th align="center">BLDG1</th><th align="center">BLDG2</th></tr></thead><tbody><tr><td align="left"><a href="Big500users.html#ch5-massivesmb" title="Example 5.1. Server: MASSIVE (PDC), File: /etc/samba/smb.conf">???</a></td><td align="left"><tt class="filename">/etc/samba/smb.conf</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#ch5-dc-common" title="Example 5.2. Server: MASSIVE (PDC), File: /etc/samba/dc-common.conf">???</a></td><td align="left"><tt class="filename">/etc/samba/dc-common.conf</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#ch5-commonsmb" title="Example 5.3. Common Samba Configuration File: /etc/samba/common.conf">???</a></td><td align="left"><tt class="filename">/etc/samba/common.conf</tt></td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="left"><a href="Big500users.html#ch5-bldg1-smb" title="Example 5.4. Server: BLDG1 (Member), File: smb.conf">???</a></td><td align="left"><tt class="filename">/etc/samba/smb.conf</tt></td><td align="center">No</td><td align="center">Yes</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#ch5-bldg2-smb" title="Example 5.5. Server: BLDG2 (Member), File: smb.conf">???</a></td><td align="left"><tt class="filename">/etc/samba/smb.conf</tt></td><td align="center">No</td><td align="center">No</td><td align="center">Yes</td></tr><tr><td align="left"><a href="Big500users.html#ch5-dommem-smb" title="Example 5.6. Common Domain Member Include File: dom-mem.conf">???</a></td><td align="left"><tt class="filename">/etc/samba/dommem.conf</tt></td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="left"><a href="Big500users.html#massive-dhcp" title="Example 5.7. Server: MASSIVE, File: dhcpd.conf">???</a></td><td align="left"><tt class="filename">/etc/dhcpd.conf</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#bldg1dhcp" title="Example 5.8. Server: BLDG1, File: dhcpd.conf">???</a></td><td align="left"><tt class="filename">/etc/dhcpd.conf</tt></td><td align="center">No</td><td align="center">Yes</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#bldg2dhcp" title="Example 5.9. Server: BLDG2, File: dhcpd.conf">???</a></td><td align="left"><tt class="filename">/etc/dhcpd.conf</tt></td><td align="center">No</td><td align="center">No</td><td align="center">Yes</td></tr><tr><td align="left"><a href="Big500users.html#massive-nameda" title="Example 5.10. Server: MASSIVE, File: named.conf, Part: A">???</a></td><td align="left"><tt class="filename">/etc/named.conf (part A)</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#massive-namedb" title="Example 5.11. Server: MASSIVE, File: named.conf, Part: B">???</a></td><td align="left"><tt class="filename">/etc/named.conf (part B)</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#massive-namedc" title="Example 5.12. Server: MASSIVE, File: named.conf, Part: C">???</a></td><td align="left"><tt class="filename">/etc/named.conf (part C)</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#abmasbizdns" title="Example 5.13. Forward Zone File: abmas.biz.hosts">???</a></td><td align="left"><tt class="filename">{VLN}/master/abmas.biz.hosts</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#abmasusdns" title="Example 5.14. Forward Zone File: abmas.biz.hosts">???</a></td><td align="left"><tt class="filename">{VLN}/master/abmas.us.hosts</tt></td><td align="center">Yes</td><td align="center">No</td><td align="center">No</td></tr><tr><td align="left"><a href="Big500users.html#bldg12nameda" title="Example 5.15. Servers: BLDG1/BLDG2, File: named.conf, Part: A">???</a></td><td align="left"><tt class="filename">/etc/named.conf (part A)</tt></td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="left"><a href="Big500users.html#bldg12namedb" title="Example 5.16. Servers: BLDG1/BLDG2, File: named.conf, Part: B">???</a></td><td align="left"><tt class="filename">/etc/named.conf (part B)</tt></td><td align="center">No</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="left"><a href="appendix.html#loopback" title="Example A.3. DNS Localhost Forward Zone File: /var/lib/named/localhost.zone">???</a></td><td align="left"><tt class="filename">{VLN}/localhost.zone</tt></td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="left"><a href="appendix.html#dnsloopy" title="Example A.4. DNS Localhost Reverse Zone File: /var/lib/named/127.0.0.zone">???</a></td><td align="left"><tt class="filename">{VLN}/127.0.0.zone</tt></td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="left"><a href="appendix.html#roothint" title="Example A.5. DNS Root Name Server Hint File: /var/lib/named/root.hint">???</a></td><td align="left"><tt class="filename">{VLN}/root.hint</tt></td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td></tr></tbody></table></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2546900"></a>Server Preparation  All Servers</h3></div></div></div><p>
	The following steps apply to all servers. Follow each step carefully.
	</p><div class="procedure"><ol type="1"><li><p>
			Using the UNIX/Linux system tools, set the name of the server as shown in the network
			topology diagram in <a href="Big500users.html#chap05net" title="Figure 5.1. Network Topology  500 User Network Using tdbsam passdb backend.">???</a>. For SUSE Linux products, the tool
			that permits this is called <span><b class="command">yast2</b></span>; for Red Hat Linux products,
			you can use the <span><b class="command">netcfg</b></span> tool.
			Verify that your hostname is correctly set by running:
</p><pre class="screen">
<tt class="prompt">root# </tt> uname -n
</pre><p>
			An alternate method to verify the hostname is:
</p><pre class="screen">
<tt class="prompt">root# </tt> hostname -f
</pre><p>
			</p></li><li><p>
	      <a class="indexterm" name="id2546973"></a><a class="indexterm" name="id2546979"></a>
			Edit your <tt class="filename">/etc/hosts</tt> file to include the primary names and addresses
			of all network interfaces that are on the host server. This is necessary so that during
			startup the system is able to resolve all its own names to the IP address prior to
			startup of the DNS server. You should check the startup order of your system. If the 
			CUPS print server is started before the DNS server (<span><b class="command">named</b></span>), you 
			should also include an entry for the printers in the <tt class="filename">/etc/hosts</tt> file.
			</p></li><li><p>
			<a class="indexterm" name="id2547020"></a>
			All DNS name resolution should be handled locally. To ensure that the server is configured
			correctly to handle this, edit <tt class="filename">/etc/resolv.conf</tt> so it has the following
			content:
</p><pre class="screen">
search abmas.us abmas.biz
nameserver 127.0.0.1
</pre><p>
			This instructs the name resolver function (when configured correctly) to ask the DNS server
			that is running locally to resolve names to addresses.
			</p></li><li><p>
	      <a class="indexterm" name="id2547051"></a><a class="indexterm" name="id2547057"></a>
			Add the <tt class="constant">root</tt> user to the password backend as follows:
</p><pre class="screen">
<tt class="prompt">root# </tt> smbpasswd -a root
New SMB password: XXXXXXXX
Retype new SMB password: XXXXXXXX
<tt class="prompt">root# </tt>
</pre><p>
			The <tt class="constant">root</tt> account is the UNIX equivalent of the Windows Domain Administrator.
			This account is essential in the regular maintenance of your Samba server. It must never be
			deleted. If for any reason the account is deleted, you may not be able to recreate this account
			without considerable trouble.
			</p></li><li><p>
	      <a class="indexterm" name="id2547105"></a><a class="indexterm" name="id2547111"></a>
			Create the username map file to permit the <tt class="constant">root</tt> account to be called
			<tt class="constant">Administrator</tt> from the Windows network environment. To do this, create
			the file <tt class="filename">/etc/samba/smbusers</tt> with the following contents:
</p><pre class="screen">
####
# User mapping file
####
# File Format
# -----------
# Unix_ID = Windows_ID
#
# Examples:
# root = Administrator
# janes = "Jane Smith"
# jimbo = Jim Bones
#
# Note: If the name contains a space it must be double quoted.
#       In the example above the name 'jimbo' will be mapped to Windows
#       user names 'Jim' and 'Bones' because the space was not quoted.
#######################################################################
root = Administrator
####
# End of File
####
</pre><p>
			</p></li><li><p>
			Configure all network attached printers to have a fixed IP address.
			</p></li><li><p>
			Create an entry in the DNS database on the server <tt class="constant">MASSIVE</tt>
			in both the forward lookup database for the zone <tt class="constant">abmas.biz.hosts</tt>
			and in the reverse lookup database for the network segment that the printer is
			located in. Example configuration files for similar zones were presented in
			<a href="secure.html#abmasbiz" title="Example 4.14. DNS Abmas.biz Forward Zone File">???</a> and <a href="secure.html#eth2zone" title="Example 4.13. DNS 192.168.2 Reverse Zone File">???</a>.
			</p></li><li><p>
			Follow the instructions in the printer manufacturer's manuals to permit printing 
			to port 9100.  Use any other port the manufacturer specifies for direct mode, 
			raw printing.  This allows the CUPS spooler to print using raw mode protocols.
			<a class="indexterm" name="id2547199"></a>
			<a class="indexterm" name="id2547205"></a>
			</p></li><li><p>
			<a class="indexterm" name="id2547219"></a>
			Only on the server to which the printer is attached configure the CUPS Print 
			Queues as follows:
</p><pre class="screen">
<tt class="prompt">root# </tt> lpadmin -p <i class="parameter"><tt>printque</tt></i> -v socket://<i class="parameter"><tt>printer-name</tt></i>.abmas.biz:9100 -E
</pre><p>
			<a class="indexterm" name="id2547254"></a>
			This step creates the necessary print queue to use no assigned print filter. This
			is ideal for raw printing, i.e., printing without use of filters.
			The name <i class="parameter"><tt>printque</tt></i> is the name you have assigned for
			the particular printer.
			</p></li><li><p>
			Print queues may not be enabled at creation. Make certain that the queues
			you have just created are enabled by executing the following:
</p><pre class="screen">
<tt class="prompt">root# </tt> /usr/bin/enable <i class="parameter"><tt>printque</tt></i>
</pre><p>
			</p></li><li><p>
			Even though your print queue may be enabled, it is still possible that it
			does not accept print jobs. A print queue services incoming printing
			requests only when configured to do so. Ensure that your print queue is
			set to accept incoming jobs by executing the following command:
</p><pre class="screen">
<tt class="prompt">root# </tt> /usr/bin/accept <i class="parameter"><tt>printque</tt></i>
</pre><p>
			</p></li><li><p>
			<a class="indexterm" name="id2547333"></a>
			<a class="indexterm" name="id2547340"></a>
			<a class="indexterm" name="id2547347"></a>
			Edit the file <tt class="filename">/etc/cups/mime.convs</tt> to uncomment the line:
</p><pre class="screen">
application/octet-stream     application/vnd.cups-raw      0     -
</pre><p>
			</p></li><li><p>
			<a class="indexterm" name="id2547374"></a>
			Edit the file <tt class="filename">/etc/cups/mime.types</tt> to uncomment the line:
</p><pre class="screen">
application/octet-stream
</pre><p>
			</p></li><li><p>
			Refer to the CUPS printing manual for instructions regarding how to configure
			CUPS so that print queues that reside on CUPS servers on remote networks
			route print jobs to the print server that owns that queue. The default setting
			on your CUPS server may automatically discover remotely installed printers and
			may permit this functionality without requiring specific configuration.
			</p></li><li><p>
			As part of the rollout program, you need to configure the application's
			server shares. This can be done once on the central server and may then be
			replicated using a tool such as <span><b class="command">rsync</b></span>. Refer to the man
			page for <span><b class="command">rsync</b></span> for details regarding use. The notes in	
			<a href="secure.html#ch4appscfg" title="Application Share Configuration">???</a> may help in your decisions to use an application
			server facility.
			</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	Logon scripts that are run from a Domain Controller (PDC or BDC) are capable of using semi-intelligent
	processes to auto-map Windows client drives to an application server that is nearest to the client. This
	is considerably more difficult when a single PDC is used on a routed network. It can be done, but not
	as elegantly as you see in the next chapter.
	</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2547452"></a>Server Specific Preparation</h3></div></div></div><p>
	There are some steps that apply to particular server functionality only. Each step is critical
	to correct server operation.
	</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2547463"></a>Configuration for Server: <tt class="constant">MASSIVE</tt></h4></div></div></div><div class="procedure"><ol type="1"><li><p>
			<a class="indexterm" name="id2547479"></a>
			<a class="indexterm" name="id2547486"></a>
			The host server acts as a router between the two internal network segments as well
			as for all Internet access. This necessitates that IP forwarding must be enabled. This can be
			achieved by adding to the <tt class="filename">/etc/rc.d/boot.local</tt> an entry as follows:
</p><pre class="screen">
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</pre><p>
			To ensure that your kernel is capable of IP forwarding during configuration, you may wish to execute
			that command manually also. This setting permits the Linux system to act as a router.
			</p></li><li><p>
			This server is dual hosted (i.e., has two network interfaces)  one goes to the Internet,
			and the other to a local network that has a router that is the gateway to the remote networks.
			You must, therefore, configure the server with route table entries so that it can find machines
			on the remote networks. You can do this using the appropriate system tools for your Linux
			server or using static entries that you place in one of the system startup files. It is best
			to always use the tools that the operating system vendor provided. In the case of SUSE Linux, the
			best tool to do this is YaST (refer to SUSE Administration Manual); in the case of Red Hat,
			this is best done using the graphical system configuration tools (see the Red Hat documentation).
			An example of how this may be done manually is as follows:
</p><pre class="screen">
<tt class="prompt">root# </tt> route add net 172.16.4.0 netmask 255.255.252.0 gw 172.16.0.128
<tt class="prompt">root# </tt> route add net 172.16.8.0 netmask 255.255.252.0 gw 172.16.0.128
</pre><p>
			If you just execute these commands manually, the route table entries you have created are
			not persistent across system reboots. You may add these commands directly to the local
			startup files as follows: (SUSE) <tt class="filename">/etc/rc.d/boot.local</tt>, (Red Hat)
			<tt class="filename">/etc/rc.d/init.d/rc.local</tt>.
			</p></li><li><p>
			<a class="indexterm" name="id2547580"></a>
			The final step that must be completed is to edit the <tt class="filename">/etc/nsswitch.conf</tt> file.
			This file controls the operation of the various resolver libraries that are part of the Linux
			Glibc libraries. Edit this file so that it contains the following entries:
</p><pre class="screen">
hosts:      files dns wins
</pre><p>
			</p></li><li><p>
			<a class="indexterm" name="id2547610"></a>
			Create and map Windows Domain Groups to UNIX groups. A sample script is provided in
			<a href="Big500users.html#ch5-initgrps" title="Example 5.17. Initialize Groups Script, File: /etc/samba/initGrps.sh">???</a>. Create a file containing this script. You called yours
			<tt class="filename">/etc/samba/initGrps.sh</tt>. Set this file so it can be executed
			and then execute the script. An example of the execution of this script as well as its
			validation are shown in Chapter 4, Section 4.3.2, Step 5.
			</p></li><li><p>
			<a class="indexterm" name="id2547642"></a>
			<a class="indexterm" name="id2547649"></a>
			<a class="indexterm" name="id2547658"></a>
			For each user who needs to be given a Windows Domain account, make an entry in the
			<tt class="filename">/etc/passwd</tt> file, as well as in the Samba password backend.
			Use the system tool of your choice to create the UNIX system account and use the Samba
			<span><b class="command">smbpasswd</b></span> to create a Domain user account.
			</p><p>
			<a class="indexterm" name="id2547684"></a>
			<a class="indexterm" name="id2547691"></a>
			<a class="indexterm" name="id2547698"></a>
			There are a number of tools for user management under UNIX. Commonly known ones include:
			<span><b class="command">useradd, adduser</b></span>. In addition to these, there is a plethora of custom
			tools. With the tool of your choice, create a home directory for each user.
			</p></li><li><p>
			Using the preferred tool for your UNIX system, add each user to the UNIX groups created
			previously as necessary. File system access control based on UNIX group membership.
			</p></li><li><p>
			Create the directory mount point for the disk sub-system that is to be mounted to provide
			data storage for company files. In this case, the mount point indicated in the <tt class="filename">smb.conf</tt>
			file is <tt class="filename">/data</tt>. Format the file system as required and mount the formatted
			file system partition using appropriate system tools.
			</p></li><li><p>
		<a class="indexterm" name="id2547757"></a>
			Create the top-level file storage directories for data and applications as follows:
</p><pre class="screen">
<tt class="prompt">root# </tt> mkdir -p /data/{accounts,finsvcs,pidata}
<tt class="prompt">root# </tt> mkdir -p /apps
<tt class="prompt">root# </tt> chown -R root.root /data
<tt class="prompt">root# </tt> chown -R root.root /apps
<tt class="prompt">root# </tt> chown -R bjordan.accounts /data/accounts
<tt class="prompt">root# </tt> chown -R bjordan.finsvcs /data/finsvcs
<tt class="prompt">root# </tt> chown -R bjordan.finsvcs /data/pidata
<tt class="prompt">root# </tt> chmod -R ug+rwxs,o-rwx /data
<tt class="prompt">root# </tt> chmod -R ug+rwx,o+rx-w /apps
</pre><p>
			Each department is responsible for creating its own directory structure within the departmental
			share. The directory root of the <span><b class="command">accounts</b></span> share is <tt class="filename">/data/accounts</tt>.
			The directory root of the <span><b class="command">finsvcs</b></span> share is <tt class="filename">/data/finsvcs</tt>.
			The <tt class="filename">/apps</tt> directory is the root of the <tt class="constant">apps</tt> share
			that provides the application server infrastructure.
			</p></li><li><p>
			The <tt class="filename">smb.conf</tt> file specifies an infrastructure to support roaming profiles and network
			logon services. You can now create the file system infrastructure to provide the
			locations on disk that these services require. Adequate planning is essential
			since desktop profiles can grow to be quite large. For planning purposes, a minimum of
			200 Megabytes of storage should be allowed per user for profile storage. The following
			commands create the directory infrastructure needed:
</p><pre class="screen">
<tt class="prompt">root# </tt> mkdir -p /var/spool/samba
<tt class="prompt">root# </tt> mkdir -p /var/lib/samba/{netlogon/scripts,profiles}
<tt class="prompt">root# </tt> chown -R root.root /var/spool/samba
<tt class="prompt">root# </tt> chown -R root.root /var/lib/samba
<tt class="prompt">root# </tt> chmod a+rwxt /var/spool/samba
</pre><p>
			For each user account that is created on the system, the following commands should be
			executed:
</p><pre class="screen">
<tt class="prompt">root# </tt> mkdir /var/lib/samba/profiles/'username'
<tt class="prompt">root# </tt> chown 'username'.users /var/lib/samba/profiles/'username'
<tt class="prompt">root# </tt> chmod ug+wrx,o+rx,-w /var/lib/samba/profiles/'username'
</pre><p>
			</p></li><li><p>
			Create a logon script. It is important that each line is correctly terminated with
			a carriage return and line-feed combination (i.e., DOS encoding). The following procedure
			works if the right tools (<tt class="constant">unxi2dos</tt> and <tt class="constant">dos2unix</tt>) are installed.
			First, create a file called <tt class="filename">/var/lib/samba/netlogon/scripts/logon.bat.unix</tt>
			with the following contents:
</p><pre class="screen">
net time \\massive /set /yes
net use h: /home
</pre><p>
			Convert the UNIX file to a DOS file as follows:
</p><pre class="screen">
<tt class="prompt">root# </tt> dos2unix &lt; /var/lib/samba/netlogon/scripts/logon.bat.unix \
        &gt; /var/lib/samba/netlogon/scripts/logon.bat
</pre><p>
			</p></li><li><p>
			There is one preparatory step without which you cannot have a working Samba network
			environment. You must add an account for each network user. You can do this by executing
			the following steps for each user:
</p><pre class="screen">
<tt class="prompt">root# </tt> useradd -m <i class="parameter"><tt>username</tt></i>
<tt class="prompt">root# </tt> passwd <i class="parameter"><tt>username</tt></i>
Changing password for <i class="parameter"><tt>username</tt></i>.
New password: XXXXXXXX
Re-enter new password: XXXXXXXX
Password changed
<tt class="prompt">root# </tt> smbpasswd -a <i class="parameter"><tt>username</tt></i>
New SMB password: XXXXXXXX
Retype new SMB password: XXXXXXXX
Added user <i class="parameter"><tt>username</tt></i>.
</pre><p>
			You do, of course, use a valid user login ID in place of <i class="parameter"><tt>username</tt></i>.
			</p></li><li><p>
			Follow the processes shown in <a href="Big500users.html#ch5-procstart" title="Process Startup Configuration">???</a> to start all services.
			</p></li><li><p>
			Your server is ready for validation testing. Do not proceed with the steps in
			<a href="Big500users.html#ch5-domsvrspec" title="Configuration Specific to Domain Member Servers: BLDG1, BLDG2">???</a> until after the operation of the server has been
			validated following the same methods as outlined in <a href="secure.html#ch4valid" title="Validation">???</a>.
			</p></li></ol></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="ch5-domsvrspec"></a>Configuration Specific to Domain Member Servers: <tt class="constant">BLDG1, BLDG2</tt></h4></div></div></div><div class="procedure"><ol type="1"><li><p>
                        <a class="indexterm" name="id2548138"></a>
                        The final step that must be completed is to edit the <tt class="filename">/etc/nsswitch.conf</tt> file.
                        This file controls the operation of the various resolver libraries that are part of the Linux
                        Glibc libraries. Edit this file so that it contains the following entries:
</p><pre class="screen">
passwd:     files winbind
group:      files winbind
hosts:      files dns wins
</pre><p>
                        </p></li><li><p>
			Follow the steps outlined in <a href="Big500users.html#ch5-procstart" title="Process Startup Configuration">???</a> to start all services. Do not
			start Samba at this time. Samba is controlled by the process called <span><b class="command">smb</b></span>.
			</p></li><li><p><a class="indexterm" name="id2548189"></a>
			At this time, you must now attempt to join the Domain Member servers to the Domain. The following
			instructions should be executed to effect this:
</p><pre class="screen">
<tt class="prompt">root# </tt> net rpc join 
</pre><p>
			</p></li><li><p><a class="indexterm" name="id2548224"></a>
			You now start the Samba services by executing:
</p><pre class="screen">
<tt class="prompt">root# </tt> service smb start
</pre><p>
			</p></li><li><p>
                        Your server is ready for validation testing. Do not proceed with the steps in
                        <a href="Big500users.html#ch5-domsvrspec" title="Configuration Specific to Domain Member Servers: BLDG1, BLDG2">???</a> until after the operation of the server has been
                        validated following the same methods as outlined in <a href="secure.html#ch4valid" title="Validation">???</a>.
                        </p></li></ol></div></div></div><div class="example"><a name="ch5-massivesmb"></a><p class="title"><b>Example 5.1. Server: MASSIVE (PDC), File: /etc/samba/smb.conf</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td># Global parameters</td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2548311"></a><i class="parameter"><tt>
					
				workgroup = MEGANET</tt></i></td></tr><tr><td><a class="indexterm" name="id2548326"></a><i class="parameter"><tt>
					
				netbios name = MASSIVE</tt></i></td></tr><tr><td><a class="indexterm" name="id2548342"></a><i class="parameter"><tt>
					
				interfaces = eth1, lo</tt></i></td></tr><tr><td><a class="indexterm" name="id2548357"></a><i class="parameter"><tt>
					
				bind interfaces only = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2548373"></a><i class="parameter"><tt>
					
				passdb backend = tdbsam</tt></i></td></tr><tr><td><a class="indexterm" name="id2548389"></a><i class="parameter"><tt>
					
				add user script = /usr/sbin/useradd -m '%u'</tt></i></td></tr><tr><td><a class="indexterm" name="id2548405"></a><i class="parameter"><tt>
					
				delete user script = /usr/sbin/userdel -r '%u'</tt></i></td></tr><tr><td><a class="indexterm" name="id2548421"></a><i class="parameter"><tt>
					
				add group script = /usr/sbin/groupadd '%g'</tt></i></td></tr><tr><td><a class="indexterm" name="id2548437"></a><i class="parameter"><tt>
					
				delete group script = /usr/sbin/groupdel '%g'</tt></i></td></tr><tr><td><a class="indexterm" name="id2548453"></a><i class="parameter"><tt>
					
				add user to group script = /usr/sbin/usermod -G '%g' '%u'</tt></i></td></tr><tr><td><a class="indexterm" name="id2548469"></a><i class="parameter"><tt>
					
				add machine script = /usr/sbin/</tt></i></td></tr><tr><td><i class="parameter"><tt>useradd -s /bin/false -d /var/lib/nobody '%u'</tt></i></td></tr><tr><td><a class="indexterm" name="id2548492"></a><i class="parameter"><tt>
					
				preferred master = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2548508"></a><i class="parameter"><tt>
					
				wins support = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2548523"></a><i class="parameter"><tt>
					
				include = /etc/samba/dc-common.conf</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[IPC$]</tt></i></td></tr><tr><td><a class="indexterm" name="id2548548"></a><i class="parameter"><tt>
					
				path = /tmp</tt></i></td></tr><tr><td><a class="indexterm" name="id2548563"></a><i class="parameter"><tt>
					
				hosts allow = 172.16.0.0/16, 127.0.0.1</tt></i></td></tr><tr><td><a class="indexterm" name="id2548579"></a><i class="parameter"><tt>
					
				hosts deny = 0.0.0.0/0</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[accounts]</tt></i></td></tr><tr><td><a class="indexterm" name="id2548603"></a><i class="parameter"><tt>
					
				comment = Accounting Files</tt></i></td></tr><tr><td><a class="indexterm" name="id2548619"></a><i class="parameter"><tt>
					
				path = /data/accounts</tt></i></td></tr><tr><td><a class="indexterm" name="id2548634"></a><i class="parameter"><tt>
					
				read only = No</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[service]</tt></i></td></tr><tr><td><a class="indexterm" name="id2548658"></a><i class="parameter"><tt>
					
				comment = Financial Services Files</tt></i></td></tr><tr><td><a class="indexterm" name="id2548674"></a><i class="parameter"><tt>
					
				path = /data/service</tt></i></td></tr><tr><td><a class="indexterm" name="id2548689"></a><i class="parameter"><tt>
					
				read only = No</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[pidata]</tt></i></td></tr><tr><td><a class="indexterm" name="id2548714"></a><i class="parameter"><tt>
					
				comment = Property Insurance Files</tt></i></td></tr><tr><td><a class="indexterm" name="id2548730"></a><i class="parameter"><tt>
					
				path = /data/pidata</tt></i></td></tr><tr><td><a class="indexterm" name="id2548745"></a><i class="parameter"><tt>
					
				read only = No</tt></i></td></tr></table></div><div class="example"><a name="ch5-dc-common"></a><p class="title"><b>Example 5.2. Server: MASSIVE (PDC), File: /etc/samba/dc-common.conf</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td># Global parameters</td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2548791"></a><i class="parameter"><tt>
					
				shutdown script = /var/lib/samba/scripts/shutdown.sh</tt></i></td></tr><tr><td><a class="indexterm" name="id2548808"></a><i class="parameter"><tt>
					
				abort shutdown script = /sbin/shutdown -c</tt></i></td></tr><tr><td><a class="indexterm" name="id2548824"></a><i class="parameter"><tt>
					
				logon script = scripts\logon.bat</tt></i></td></tr><tr><td><a class="indexterm" name="id2548840"></a><i class="parameter"><tt>
					
				logon path = \%L\profiles\%U</tt></i></td></tr><tr><td><a class="indexterm" name="id2548855"></a><i class="parameter"><tt>
					
				logon drive = X:</tt></i></td></tr><tr><td><a class="indexterm" name="id2548870"></a><i class="parameter"><tt>
					
				logon home = \%L\%U</tt></i></td></tr><tr><td><a class="indexterm" name="id2548886"></a><i class="parameter"><tt>
					
				domain logons = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2548901"></a><i class="parameter"><tt>
					
				preferred master = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2548917"></a><i class="parameter"><tt>
					
				include = /etc/samba/common.conf</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[homes]</tt></i></td></tr><tr><td><a class="indexterm" name="id2548941"></a><i class="parameter"><tt>
					
				comment = Home Directories</tt></i></td></tr><tr><td><a class="indexterm" name="id2548957"></a><i class="parameter"><tt>
					
				valid users = %S</tt></i></td></tr><tr><td><a class="indexterm" name="id2548972"></a><i class="parameter"><tt>
					
				read only = No</tt></i></td></tr><tr><td><a class="indexterm" name="id2548988"></a><i class="parameter"><tt>
					
				browseable = No</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[netlogon]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549012"></a><i class="parameter"><tt>
					
				comment = Network Logon Service</tt></i></td></tr><tr><td><a class="indexterm" name="id2549028"></a><i class="parameter"><tt>
					
				path = /var/lib/samba/netlogon</tt></i></td></tr><tr><td><a class="indexterm" name="id2549043"></a><i class="parameter"><tt>
					
				guest ok = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549059"></a><i class="parameter"><tt>
					
				locking = No</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[profiles]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549082"></a><i class="parameter"><tt>
					
				comment = Profile Share</tt></i></td></tr><tr><td><a class="indexterm" name="id2549098"></a><i class="parameter"><tt>
					
				path = /var/lib/samba/profiles</tt></i></td></tr><tr><td><a class="indexterm" name="id2549113"></a><i class="parameter"><tt>
					
				read only = No</tt></i></td></tr><tr><td><a class="indexterm" name="id2549129"></a><i class="parameter"><tt>
					
				profile acls = Yes</tt></i></td></tr></table></div><div class="example"><a name="ch5-commonsmb"></a><p class="title"><b>Example 5.3. Common Samba Configuration File: /etc/samba/common.conf</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549170"></a><i class="parameter"><tt>
					
				username map = /etc/samba/smbusers</tt></i></td></tr><tr><td><a class="indexterm" name="id2549186"></a><i class="parameter"><tt>
					
				log level = 1</tt></i></td></tr><tr><td><a class="indexterm" name="id2549201"></a><i class="parameter"><tt>
					
				syslog = 0</tt></i></td></tr><tr><td><a class="indexterm" name="id2549216"></a><i class="parameter"><tt>
					
				log file = /var/log/samba/%m</tt></i></td></tr><tr><td><a class="indexterm" name="id2549231"></a><i class="parameter"><tt>
					
				max log size = 50</tt></i></td></tr><tr><td><a class="indexterm" name="id2549247"></a><i class="parameter"><tt>
					
				smb ports = 139 445</tt></i></td></tr><tr><td><a class="indexterm" name="id2549262"></a><i class="parameter"><tt>
					
				name resolve order = wins bcast hosts</tt></i></td></tr><tr><td><a class="indexterm" name="id2549278"></a><i class="parameter"><tt>
					
				time server = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549293"></a><i class="parameter"><tt>
					
				printcap name = CUPS</tt></i></td></tr><tr><td><a class="indexterm" name="id2549309"></a><i class="parameter"><tt>
					
				show add printer wizard = No</tt></i></td></tr><tr><td><a class="indexterm" name="id2549325"></a><i class="parameter"><tt>
					
				shutdown script = /var/lib/samba/scripts/shutdown.sh</tt></i></td></tr><tr><td><a class="indexterm" name="id2549341"></a><i class="parameter"><tt>
					
				abort shutdown script = /sbin/shutdown -c</tt></i></td></tr><tr><td><a class="indexterm" name="id2549358"></a><i class="parameter"><tt>
					
				utmp = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549372"></a><i class="parameter"><tt>
					
				map acl inherit = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549388"></a><i class="parameter"><tt>
					
				printing = cups</tt></i></td></tr><tr><td><a class="indexterm" name="id2549403"></a><i class="parameter"><tt>
					
				veto files = /*.eml/*.nws/*.{*}/</tt></i></td></tr><tr><td><a class="indexterm" name="id2549420"></a><i class="parameter"><tt>
					
				veto oplock files = /*.doc/*.xls/*.mdb/</tt></i></td></tr><tr><td><a class="indexterm" name="id2549435"></a><i class="parameter"><tt>
					
				include =  </tt></i></td></tr><tr><td># Share and Service Definitions are common to all servers</td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[printers]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549466"></a><i class="parameter"><tt>
					
				comment = SMB Print Spool</tt></i></td></tr><tr><td><a class="indexterm" name="id2549481"></a><i class="parameter"><tt>
					
				path = /var/spool/samba</tt></i></td></tr><tr><td><a class="indexterm" name="id2549497"></a><i class="parameter"><tt>
					
				guest ok = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549512"></a><i class="parameter"><tt>
					
				printable = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549528"></a><i class="parameter"><tt>
					
				use client driver = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549543"></a><i class="parameter"><tt>
					
				default devmode = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549559"></a><i class="parameter"><tt>
					
				browseable = No</tt></i></td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[apps]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549583"></a><i class="parameter"><tt>
					
				comment = Application Files</tt></i></td></tr><tr><td><a class="indexterm" name="id2549599"></a><i class="parameter"><tt>
					
				path = /apps</tt></i></td></tr><tr><td><a class="indexterm" name="id2549614"></a><i class="parameter"><tt>
					
				admin users = bjordan</tt></i></td></tr><tr><td><a class="indexterm" name="id2549629"></a><i class="parameter"><tt>
					
				read only = No</tt></i></td></tr></table></div><div class="example"><a name="ch5-bldg1-smb"></a><p class="title"><b>Example 5.4. Server: BLDG1 (Member), File: smb.conf</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td># Global parameters</td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549675"></a><i class="parameter"><tt>
					
				workgroup = MEGANET</tt></i></td></tr><tr><td><a class="indexterm" name="id2549691"></a><i class="parameter"><tt>
					
				netbios name = BLDG1</tt></i></td></tr><tr><td><a class="indexterm" name="id2549706"></a><i class="parameter"><tt>
					
				include = /etc/samba/dom-mem.conf</tt></i></td></tr></table></div><div class="example"><a name="ch5-bldg2-smb"></a><p class="title"><b>Example 5.5. Server: BLDG2 (Member), File: smb.conf</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td># Global parameters</td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549753"></a><i class="parameter"><tt>
					
				workgroup = MEGANET</tt></i></td></tr><tr><td><a class="indexterm" name="id2549769"></a><i class="parameter"><tt>
					
				netbios name = BLDG2</tt></i></td></tr><tr><td><a class="indexterm" name="id2549784"></a><i class="parameter"><tt>
					
				include = /etc/samba/dom-mem.conf</tt></i></td></tr></table></div><div class="example"><a name="ch5-dommem-smb"></a><p class="title"><b>Example 5.6. Common Domain Member Include File: dom-mem.conf</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td># Global parameters</td></tr><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2549831"></a><i class="parameter"><tt>
					
				shutdown script = /var/lib/samba/scripts/shutdown.sh</tt></i></td></tr><tr><td><a class="indexterm" name="id2549848"></a><i class="parameter"><tt>
					
				abort shutdown script = /sbin/shutdown -c</tt></i></td></tr><tr><td><a class="indexterm" name="id2549864"></a><i class="parameter"><tt>
					
				preferred master = Yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2549879"></a><i class="parameter"><tt>
					
				wins server = 172.16.0.1</tt></i></td></tr><tr><td><a class="indexterm" name="id2549894"></a><i class="parameter"><tt>
					
				idmap uid = 15000-20000</tt></i></td></tr><tr><td><a class="indexterm" name="id2549910"></a><i class="parameter"><tt>
					
				idmap gid = 15000-20000</tt></i></td></tr><tr><td><a class="indexterm" name="id2549925"></a><i class="parameter"><tt>
					
				include = /etc/samba/common.conf</tt></i></td></tr></table></div><div class="example"><a name="massive-dhcp"></a><p class="title"><b>Example 5.7. Server: MASSIVE, File: dhcpd.conf</b></p><pre class="screen">
# Abmas Accounting Inc. - Chapter 5/MASSIVE

default-lease-time 86400;
max-lease-time 172800;
default-lease-time 86400;
ddns-updates on;
ddns-update-style ad-hoc;

option ntp-servers 172.16.0.1;
option domain-name "abmas.biz";
option domain-name-servers 172.16.0.1, 172.16.4.1;
option netbios-name-servers 172.16.0.1;
option netbios-node-type 8;

subnet 172.16.1.0 netmask 255.255.252.0 {
        range dynamic-bootp 172.16.1.0 172.16.2.255;
        option subnet-mask 255.255.252.0;
        option routers 172.16.0.1, 172.16.0.128;
        allow unknown-clients;
	}
subnet 172.16.4.0 netmask 255.255.252.0 {
        range dynamic-bootp 172.16.7.0 172.16.7.254;
        option subnet-mask 255.255.252.0;
        option routers 172.16.4.128;
        allow unknown-clients;
	}
subnet 172.16.8.0 netmask 255.255.252.0 {
        range dynamic-bootp 172.16.11.0 172.16.11.254;
        option subnet-mask 255.255.252.0;
        option routers 172.16.4.128;
        allow unknown-clients;
	}
subnet 127.0.0.0 netmask 255.0.0.0 {
        }
subnet 123.45.67.64 netmask 255.255.255.252 {
        }
</pre></div><div class="example"><a name="bldg1dhcp"></a><p class="title"><b>Example 5.8. Server: BLDG1, File: dhcpd.conf</b></p><pre class="screen">
# Abmas Accounting Inc. - Chapter 5/BLDG1

default-lease-time 86400;
max-lease-time 172800;
default-lease-time 86400;
ddns-updates on;
ddns-update-style ad-hoc;

option ntp-servers 172.16.0.1;
option domain-name "abmas.biz";
option domain-name-servers 172.16.0.1, 172.16.4.1;
option netbios-name-servers 172.16.0.1;
option netbios-node-type 8;

subnet 172.16.1.0 netmask 255.255.252.0 {
        range dynamic-bootp 172.16.3.0 172.16.2.254;
        option subnet-mask 255.255.252.0;
        option routers 172.16.0.1, 172.16.0.128;
        allow unknown-clients;
	}
subnet 172.16.4.0 netmask 255.255.252.0 {
        range dynamic-bootp 172.16.5.0 172.16.6.255;
        option subnet-mask 255.255.252.0;
        option routers 172.16.4.128;
        allow unknown-clients;
	}
subnet 127.0.0.0 netmask 255.0.0.0 {
        }
</pre></div><div class="example"><a name="bldg2dhcp"></a><p class="title"><b>Example 5.9. Server: BLDG2, File: dhcpd.conf</b></p><pre class="screen">
# Abmas Accounting Inc. - Chapter 5/BLDG1

default-lease-time 86400;
max-lease-time 172800;
default-lease-time 86400;
ddns-updates on;
ddns-update-style ad-hoc;

option ntp-servers 172.16.0.1;
option domain-name "abmas.biz";
option domain-name-servers 172.16.0.1, 172.16.4.1;
option netbios-name-servers 172.16.0.1;
option netbios-node-type 8;

subnet 172.16.8.0 netmask 255.255.252.0 {
        range dynamic-bootp 172.16.9.0 172.16.10.255;
        option subnet-mask 255.255.252.0;
        option routers 172.16.8.128;
        allow unknown-clients;
	}
subnet 127.0.0.0 netmask 255.0.0.0 {
        }
</pre></div><div class="example"><a name="massive-nameda"></a><p class="title"><b>Example 5.10. Server: MASSIVE, File: named.conf, Part: A</b></p><pre class="screen">
###
# Abmas Biz DNS Control File
###
# Date: November 15, 2003
###
options {
	directory "/var/lib/named";
	forwarders {
		123.45.12.23;
		123.45.54.32;
		};
	forward first;
	listen-on {
		mynet;
		};
	auth-nxdomain yes;
	multiple-cnames yes;
	notify no;
};

zone "." in {
	type hint;
	file "root.hint";
};

zone "localhost" in {
	type master;
	file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
	type master;
	file "127.0.0.zone";
};

acl mynet {
	172.16.0.0/24;
	172.16.4.0/24;
	172.16.8.0/24;
	127.0.0.1;
};

acl seconddns {
        123.45.54.32;
}
</pre></div><div class="example"><a name="massive-namedb"></a><p class="title"><b>Example 5.11. Server: MASSIVE, File: named.conf, Part: B</b></p><pre class="screen">
zone "abmas.biz" {
	type master;
	file "/var/lib/named/master/abmas.biz.hosts";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
	allow-update {
		mynet;
	};
};

zone "abmas.us" {
        type master;
        file "/var/lib/named/master/abmas.us.hosts";
        allow-query {
                all;
        };
        allow-transfer {
                seconddns;
        };
};
</pre></div><div class="example"><a name="massive-namedc"></a><p class="title"><b>Example 5.12. Server: MASSIVE, File: named.conf, Part: C</b></p><pre class="screen">
zone "0.16.172.in-addr.arpa" {
	type master;
	file "/var/lib/named/master/172.16.0.0.rev";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
	allow-update {
		mynet;
	};
};

zone "4.16.172.in-addr.arpa" {
	type master;
	file "/var/lib/named/master/172.16.4.0.rev";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
	allow-update {
		mynet;
	};
};

zone "8.16.172.in-addr.arpa" {
	type master;
	file "/var/lib/named/master/172.16.8.0.rev";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
	allow-update {
		mynet;
	};
};
</pre></div><div class="example"><a name="abmasbizdns"></a><p class="title"><b>Example 5.13. Forward Zone File: abmas.biz.hosts</b></p><pre class="screen">
$ORIGIN .
$TTL 38400	; 10 hours 40 minutes
abmas.biz	IN SOA	massive.abmas.biz. root.abmas.biz. (
				2003021833 ; serial
				10800      ; refresh (3 hours)
				3600       ; retry (1 hour)
				604800     ; expire (1 week)
				38400      ; minimum (10 hours 40 minutes)
				)
			NS	massive.abmas.biz.
			NS	bldg1.abmas.biz.
			NS	bldg2.abmas.biz.
			MX	10 massive.abmas.biz.
$ORIGIN abmas.biz.
massive			A	172.16.0.1
router0                 A       172.16.0.128
bldg1                   A       172.16.4.1
router4                 A       172.16.4.128
bldg2                   A       172.16.8.1
router8                 A       172.16.8.128
</pre></div><div class="example"><a name="abmasusdns"></a><p class="title"><b>Example 5.14. Forward Zone File: abmas.biz.hosts</b></p><pre class="screen">
$ORIGIN .
$TTL 38400	; 10 hours 40 minutes
abmas.us	IN SOA	server.abmas.us. root.abmas.us. (
				2003021833 ; serial
				10800      ; refresh (3 hours)
				3600       ; retry (1 hour)
				604800     ; expire (1 week)
				38400      ; minimum (10 hours 40 minutes)
				)
			NS	dns.abmas.us.
			NS	dns2.abmas.us.
			MX	10 mail.abmas.us.
$ORIGIN abmas.us.
server			A	123.45.67.66
dns2			A	123.45.54.32
gw			A	123.45.67.65
www			CNAME	server
mail			CNAME	server
dns			CNAME	server
</pre></div><div class="example"><a name="bldg12nameda"></a><p class="title"><b>Example 5.15. Servers: BLDG1/BLDG2, File: named.conf, Part: A</b></p><pre class="screen">
###
# Abmas Biz DNS Control File
###
# Date: November 15, 2003
###
options {
	directory "/var/lib/named";
	forwarders {
		172.16.0.1;
		};
	forward first;
	listen-on {
		mynet;
		};
	auth-nxdomain yes;
	multiple-cnames yes;
	notify no;
};

zone "." in {
	type hint;
	file "root.hint";
};

zone "localhost" in {
	type master;
	file "localhost.zone";
};

zone "0.0.127.in-addr.arpa" in {
	type master;
	file "127.0.0.zone";
};

acl mynet {
	172.16.0.0/24;
	172.16.4.0/24;
	172.16.8.0/24;
	127.0.0.1;
};

acl seconddns {
        123.45.54.32;
}
</pre></div><div class="example"><a name="bldg12namedb"></a><p class="title"><b>Example 5.16. Servers: BLDG1/BLDG2, File: named.conf, Part: B</b></p><pre class="screen">
zone "abmas.biz" {
	type slave;
	file "/var/lib/named/slave/abmas.biz.hosts";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
};

zone "0.16.172.in-addr.arpa" {
	type slave;
	file "/var/lib/slave/master/172.16.0.0.rev";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
};

zone "4.16.172.in-addr.arpa" {
	type slave;
	file "/var/lib/named/slave/172.16.4.0.rev";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
};

zone "8.16.172.in-addr.arpa" {
	type slave;
	file "/var/lib/named/slave/172.16.8.0.rev";
	allow-query {
		mynet;
	};
	allow-transfer {
		mynet;
	};
};
</pre></div><div class="example"><a name="ch5-initgrps"></a><p class="title"><b>Example 5.17. Initialize Groups Script, File: /etc/samba/initGrps.sh</b></p><pre class="screen">
#!/bin/bash

# Create UNIX groups
groupadd acctsdep
groupadd finsrvcs
groupadd piops

# Map Windows Domain Groups to UNIX groups
net groupmap modify ntgroup="Domain Admins"  unixgroup=root
net groupmap modify ntgroup="Domain Users"   unixgroup=users
net groupmap modify ntgroup="Domain Guests"  unixgroup=nobody

# Add Functional Domain Groups
net groupmap add ntgroup="Accounts Dept"       unixgroup=acctsdep type=d
net groupmap add ntgroup="Financial Services"  unixgroup=finsrvcs type=d
net groupmap add ntgroup="Insurance Group"     unixgroup=piops type=d
</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ch5-procstart"></a>Process Startup Configuration</h3></div></div></div><p>
	  <a class="indexterm" name="id2550310"></a><a class="indexterm" name="id2550315"></a>
        There are two essential steps to process startup configuration. A process
        must be configured so that it is automatically restarted each time the server
        is rebooted. This step involves use of the <span><b class="command">chkconfig</b></span> tool that
        created appropriate symbolic links from the master daemon control file that is
        located in the <tt class="filename">/etc/rc.d</tt> directory to the <tt class="filename">/etc/rc'x'.d</tt>
        directories. Links are created so that when the system run-level is changed, the
        necessary start or kill script is run.
        </p><p>
        <a class="indexterm" name="id2550353"></a>
        In the event that a service is provided not as a daemon but via the inter-networking
        super daemon (<span><b class="command">inetd</b></span> or <span><b class="command">xinetd</b></span>), then the <span><b class="command">chkconfig</b></span>
        tool makes the necessary entries in the <tt class="filename">/etc/xinetd.d</tt> directory
        and sends a hang-up (HUP) signal to the super daemon, thus forcing it to
        re-read its control files.
        </p><p>
        Last, each service must be started to permit system validation to proceed.
        </p><div class="procedure"><ol type="1"><li><p>
                Use the standard system tool to configure each service to restart
                automatically at every system reboot. For example:
                <a class="indexterm" name="id2550406"></a>
</p><pre class="screen">
<tt class="prompt">root# </tt> chkconfig dhpc on
<tt class="prompt">root# </tt> chkconfig named on
<tt class="prompt">root# </tt> chkconfig cups on
<tt class="prompt">root# </tt> chkconfig smb on
<tt class="prompt">root# </tt> chkconfig swat on
</pre><p>
                </p></li><li><p>
                <a class="indexterm" name="id2550456"></a>
                <a class="indexterm" name="id2550463"></a>
                <a class="indexterm" name="id2550470"></a>
                Now start each service to permit the system to be validated.
                Execute each of the following in the sequence shown:

</p><pre class="screen">
<tt class="prompt">root# </tt> service dhcp restart
<tt class="prompt">root# </tt> service named restart
<tt class="prompt">root# </tt> service cups restart
<tt class="prompt">root# </tt> service smb restart
<tt class="prompt">root# </tt> service swat restart
</pre><p>
                </p></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="ch5wincfg"></a>Windows Client Configuration</h3></div></div></div><p>
	The procedure for desktop client configuration for the network in this chapter is similar to
	that used for the previous one. There are a few subtle changes that should be noted.
	</p><div class="procedure"><ol type="1"><li><p>
		Install MS Windows XP Professional. During installation, configure the client to use DHCP for 
		TCP/IP protocol configuration.
		<a class="indexterm" name="id2550545"></a>
		<a class="indexterm" name="id2550552"></a>
		DHCP configures all Windows clients to use the WINS Server address that has been defined
		for the local subnet.
		</p></li><li><p>
		Join the Windows Domain <tt class="constant">MEGANET</tt>. Use the Domain Administrator
		user name <tt class="constant">root</tt> and the SMB password you assigned to this account.
		A detailed step-by-step procedure for joining a Windows 200x/XP Professional client to
		a Windows Domain is given in <a href="appendix.html#domjoin" title="Joining a Domain: Windows 200x/XP Professional">???</a>. 
		Reboot the machine as prompted and then logon using the Domain Administrator account
		(<tt class="constant">root</tt>).
		</p></li><li><p>
		Verify that the server called <tt class="constant">MEGANET</tt> is visible in <span class="guimenu">My Network Places</span>, 
		that it is possible to connect to it and see the shares <span class="guimenuitem">accounts</span>,
		<span class="guimenuitem">apps</span>, and <span class="guimenuitem">finsvcs</span>,
		and that it is possible to open each share to reveal its contents.
		</p></li><li><p>
		Create a drive mapping to the <tt class="constant">apps</tt> share on a server. At this time, it does
		not particularly matter which application server is used. It is necessary to manually
		set a persistent drive mapping to the local applications server on each workstation at the time of 
		installation. This step is avoided by the improvements to the design of the network configuration
		in the next chapter.
		</p></li><li><p>
		Perform an administrative installation of each application to be used. Select the options
		that you wish to use. Of course, you choose to run applications over the network, correct?
		</p></li><li><p>
		Now install all applications to be installed locally. Typical tools includes: Adobe Acrobat,
		NTP-based time synchronization software, drivers for specific local devices such as fingerprint
		scanners, and the like. Probably the most significant application to be locally installed
		is anti-virus software.
		</p></li><li><p>
		Now install all four printers onto the staging system. The printers you install
		include the Accounting department HP LaserJet 6 and Minolta QMS Magicolor printers, and you
		also configure use of the identical printers that are located in the financial services department.
		Install printers on each machine using the following steps:

			</p><div class="procedure"><ol type="1"><li><p>
				Click <span class="guimenu">Start</span>-&gt;<span class="guimenuitem">Settings</span>-&gt;<span class="guimenuitem">Printers</span>+<span class="guiicon">Add Printer</span>+<span class="guibutton">Next</span>. Do not click <span class="guimenuitem">Network printer</span>.
					Ensure that <span class="guimenuitem">Local printer</span> is selected.
				</p></li><li><p>
				Click <span class="guibutton">Next</span>. In the panel labeled
				<span class="guimenuitem">Manufacturer:</span>, select <tt class="constant">HP</tt>.
				In the <span class="guimenuitem">Printers:</span> panel, select the printer called
				<tt class="constant">HP LaserJet 6</tt>. Click <span class="guibutton">Next</span>.
				</p></li><li><p>
				In the panel labeled <span class="guimenuitem">Available ports:</span>, select
				<tt class="constant">FILE:</tt>. Accept the default printer name by clicking
				<span class="guibutton">Next</span>. When asked, &#8220;<span class="quote"><span class="emphasis"><em>Would you like to print a
				test page?</em></span></span>&#8221;, click <span class="guimenuitem">No</span>. Click
				<span class="guibutton">Finish</span>.
				</p></li><li><p>
				You may be prompted for the name of a file to print to. If so, close the
				dialog panel. Right-click <span class="guiicon">HP LaserJet 6</span>-&gt;<span class="guimenuitem">Properties</span>.
				</p></li><li><p>
				In the panel labeled <span class="guimenuitem">Network</span>, enter the name of
				the print queue on the Samba server as follows: <tt class="constant">\\BLDG1\hplj6a</tt>.
				Click <span class="guibutton">OK</span>+<span class="guibutton">OK</span> to complete the installation.
				</p></li><li><p>
				Repeat the printer installation steps above for both HP LaserJet 6 printers
				as well as for both QMS Magicolor laser printers. Remember to install all
				printers, but to set the destination port for each to the server on the
				local network. For example, a workstation in the Accounting group should
				have all printers directed at the server <tt class="constant">BLDG1</tt>.
				You may elect to point all desktop workstation configurations at the
				server called <tt class="constant">MASSIVE</tt> and then in your deployment	
				procedures, it would be wise to document the need to redirect the printer
				configuration (as well as the applications server drive mapping) to the
				server on the network segment on which the workstation is to be located.
				</p></li></ol></div><p>
		</p></li><li><p>
		When you are satisfied that the staging systems are complete, use the appropriate procedure to
		remove the client from the domain. Reboot the system, and then log on as the local administrator
		and clean out all temporary files stored on the system. Before shutting down, use the disk
		defragmentation tool so that the file system is in an optimal condition before replication.
		</p></li><li><p>
		Boot the workstation using the Norton (Symantec) Ghosting disk (or CD-ROM) and image the
		machine to a network share on the server.
		</p></li><li><p>
		You may now replicate the image using the appropriate Norton Ghost procedure to the target
		machines. Make sure to use the procedure that ensures each machine has a unique
		Windows security identifier (SID). When the installation of the disk image has completed, boot the PC. 
		</p></li><li><p>
		Log onto the machine as the local Administrator (the only option), and join the machine to
		the Domain following the procedure set out in <a href="appendix.html#domjoin" title="Joining a Domain: Windows 200x/XP Professional">???</a>. You must now set the 
		persistent drive mapping to the applications server that the user is to use. The system is now 
		ready for the user to logon, providing you have created a network logon account for that 
		user, of course.
		</p></li><li><p>
		Instruct all users to log onto the workstation using their assigned user name and password.
		</p></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2550973"></a>Key Points Learned</h3></div></div></div><p>
		The network you have just deployed has been a valuable exercise in forced constraint.
		You have deployed a network that works well, although you may soon start to see
		performance problems, at which time the modifications demonstrated in the following
		chapter bring the network to life. The following key learning points were experienced:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
			The power of using <tt class="filename">smb.conf</tt> include files
			</p></li><li><p>
			Use of a single PDC over a routed network
			</p></li><li><p>
			Joining a Samba-3 Domain Member server to a Samba-3 Domain
			</p></li><li><p>
			Configuration of winbind to use Domain Users and Groups for Samba access
			to resources on the Domain Member servers
			</p></li><li><p>
			The introduction of roaming profiles
			</p></li></ul></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2551027"></a>Questions and Answers</h2></div></div></div><p>
	</p><div class="qandaset"><dl><dt> <a href="Big500users.html#id2551042">
		The example smb.conf files in this chapter make use of the include facility.
		How may I get to see what the actual working smb.conf settings are?
		</a></dt><dt> <a href="Big500users.html#id2551092">
		Why does the include file common.conf have an empty include statement?
		</a></dt><dt> <a href="Big500users.html#id2551154">
		I accept that the simplest configuration necessary to do the job is the best. The use of tdbsam
		passdb backend is much simpler than having to manage an LDAP-based ldapsam passdb backend.
		I tried using rsync to replicate the passdb.tdb, and it seems to work fine!
		So what is the problem?
		</a></dt><dt> <a href="Big500users.html#id2551209">
		You are using DHCP Relay enabled on the routers as well as a local DHCP server. Will this cause a clash?
		</a></dt><dt> <a href="Big500users.html#id2551239">
		How does the Windows client find the PDC?
		</a></dt><dt> <a href="Big500users.html#id2551262">
		Why did you enable IP forwarding (routing) only on the server called MASSIVE?
		</a></dt><dt> <a href="Big500users.html#id2551292">
		You did nothing special to implement roaming profiles. Why?
		</a></dt><dt> <a href="Big500users.html#id2551312">
		On the Domain Member computers, you configured winbind in the /etc/nsswitch.conf file.
		You did not configure any PAM settings. Is this an omission?
		</a></dt><dt> <a href="Big500users.html#id2551344">
		You are starting SWAT up on this example but have not discussed that anywhere. Why did you do this?
		</a></dt><dt> <a href="Big500users.html#id2551386">
		The Domain Controller has an auto-shutdown script. Isn't that dangerous?
		</a></dt></dl><table border="0" summary="Q and A Set"><col align="left" width="1%"><tbody><tr class="question"><td align="left" valign="top"><a name="id2551042"></a><a name="id2551045"></a><b></b></td><td align="left" valign="top"><p>
		The example <tt class="filename">smb.conf</tt> files in this chapter make use of the <i class="parameter"><tt>include</tt></i> facility.
		How may I get to see what the actual working <tt class="filename">smb.conf</tt> settings are?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		You may readily see the net compound effect of the included files by running:
</p><pre class="screen">
<tt class="prompt">root# </tt> testparm -s | less
</pre><p>
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551092"></a><a name="id2551094"></a><b></b></td><td align="left" valign="top"><p>
		Why does the include file <tt class="filename">common.conf</tt> have an empty include statement?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		The use of the empty include statement nullifies further includes. For example, let's say you 
		desire to have just an smb.conf file that is built from the array of include files of which the
		master control file is called <tt class="filename">master.conf</tt>. The following command 
		produces a compound <tt class="filename">smb.conf</tt> file.
</p><pre class="screen">
<tt class="prompt">root# </tt> testparm -s /etc/samba/master.conf &gt; /etc/samba/smb.conf
</pre><p>
		If the include parameter was not in the common.conf file, the final <tt class="filename">smb.conf</tt> file leaves
		the include in place, even though the file it points to has already been included. This is a bug
		that will be fixed at a future date.
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551154"></a><a name="id2551156"></a><b></b></td><td align="left" valign="top"><p>
		I accept that the simplest configuration necessary to do the job is the best. The use of <i class="parameter"><tt>tdbsam</tt></i>
		passdb backend is much simpler than having to manage an LDAP-based <i class="parameter"><tt>ldapsam</tt></i> passdb backend.
		I tried using <span><b class="command">rsync</b></span> to replicate the <tt class="filename">passdb.tdb</tt>, and it seems to work fine!
		So what is the problem?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		Replication of the <i class="parameter"><tt>tdbsam</tt></i> database file can result in loss of currency in its
		contents between the PDC and BDCs. The most notable symptom is that workstations may not be able
		to log onto the network following a reboot and may have to re-join the Domain to recover network
		access capability.
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551209"></a><a name="id2551211"></a><b></b></td><td align="left" valign="top"><p>
		You are using DHCP Relay enabled on the routers as well as a local DHCP server. Will this cause a clash?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		No. It is possible to have as many DHCP servers on a network segment as makes sense. A DHCP server
		offers an IP address lease, but it is the client that determines which offer is accepted, no matter how many
		offers are made. Under normal operation, the client accepts the first offer it receives.
		</p><p>
		The only exception to this rule is when the client makes a directed request from a specific DHCP server
		for renewal of the lease it has. This means that under normal circumstances there is no risk of a clash.
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551239"></a><a name="id2551241"></a><b></b></td><td align="left" valign="top"><p>
		How does the Windows client find the PDC?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		The Windows client obtains the WINS server address from the DHCP lease information. It also
		obtains from the DHCP lease information the parameter that causes it to use directed UDP (UDP Unicast)
		to register itself with the WINS server and to obtain enumeration of vital network information to 
		enable it to operate successfully.
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551262"></a><a name="id2551264"></a><b></b></td><td align="left" valign="top"><p>
		Why did you enable IP forwarding (routing) only on the server called <tt class="constant">MASSIVE</tt>?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		The server called <tt class="constant">MASSIVE</tt> is acting as a router to the Internet. No other server
		(BLDG1 or BLDG2) has any need for IP forwarding since they are attached only to their own network.
		Route table entries are needed to direct MASSIVE to send all traffic intended for the remote network
		segments to the router that is its gateway to them.
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551292"></a><a name="id2551295"></a><b></b></td><td align="left" valign="top"><p>
		You did nothing special to implement roaming profiles. Why?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		Unless configured to do otherwise, the default behavior with Samba-3 and Windows XP Professional
		clients is to use roaming profiles.
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551312"></a><a name="id2551314"></a><b></b></td><td align="left" valign="top"><p>
		On the Domain Member computers, you configured winbind in the <tt class="filename">/etc/nsswitch.conf</tt> file.
		You did not configure any PAM settings. Is this an omission?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		PAM is needed only for authentication. When Samba is using Microsoft encrypted passwords, it makes only
		marginal use of PAM. PAM configuration handles only authentication. If you want to log onto the Domain
		Member servers using Windows networking user names and passwords, it is necessary to configure PAM
		to enable the use of winbind. Samba makes use only of the identity resolution facilities of the name
		service switcher (NSS).
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551344"></a><a name="id2551346"></a><b></b></td><td align="left" valign="top"><p>
		You are starting SWAT up on this example but have not discussed that anywhere. Why did you do this?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		Oh, I did not think you would notice that. It is there so that it can be used. This is more fully discussed
		in <span class="emphasis"><em>TOSHARG</em></span>, where it has a full chapter dedicated to the subject. While we are on the 
		subject, it should be noted that you should definitely not use SWAT on any system that makes use 
		of <tt class="filename">smb.conf</tt> <i class="parameter"><tt>include</tt></i> files because SWAT optimizes them out into an aggregated 
		file but leaves in place a broken reference to the top layer include file. SWAT was not designed to 
		handle this functionality gracefully.
		</p></td></tr><tr class="question"><td align="left" valign="top"><a name="id2551386"></a><a name="id2551388"></a><b></b></td><td align="left" valign="top"><p>
		The Domain Controller has an auto-shutdown script. Isn't that dangerous?
		</p></td></tr><tr class="answer"><td align="left" valign="top"><b></b></td><td align="left" valign="top"><p>
		Well done, you spotted that! I guess it is dangerous. It is good to know that you can do this, though.
		</p></td></tr></tbody></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="secure.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="happy.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 4. Secure Office Networking </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 6. Making Happy Users</td></tr></table></div></body></html>
