
Pipes cannot be opened in binary mode:

diff -urN elf2flt-20051225.orig/elf2flt.c elf2flt-20051225/elf2flt.c
--- elf2flt-20051225.orig/elf2flt.c	Wed Sep 28 07:26:02 2005
+++ elf2flt-20051225/elf2flt.c	Sun Aug 13 02:45:21 2006
@@ -2009,7 +2009,7 @@
 				pclose(gf); \
 			else \
 				fclose(gf); \
-		if (!(gf = popen(cmd, "wb"))) { \
+		if (!(gf = popen(cmd, "w"))) { \
 			fprintf(stderr, "Can't run cmd %s\n", cmd); \
 			exit(4); \
 		} \


Userspace XIP support:


diff -urN elf2flt-20051225.orig/elf2flt.ld elf2flt-20051225/elf2flt.ld
--- elf2flt-20051225.orig/elf2flt.ld	Thu Aug 25 04:19:42 2005
+++ elf2flt-20051225/elf2flt.ld	Sun Aug 13 20:16:07 2006
@@ -24,7 +24,6 @@
 
 W_RODAT		*(.rodata)
 W_RODAT		*(.rodata1)
-W_RODAT		*(.rodata.*)
 
 		/* This is special code area at the end of the normal
 		   text section.  It contains a small lookup table at
@@ -50,9 +49,6 @@
 		. = ALIGN(0x20) ; 
 		LONG(-1)
 		. = ALIGN(0x20) ; 
-R_RODAT		*(.rodata)
-R_RODAT		*(.rodata1)
-R_RODAT		*(.rodata.*)
 		*(.gnu.linkonce.r*)
 		*(.data)
 		*(.data1)
@@ -61,7 +57,10 @@
 		*(.data1)
 		*(.eh_frame)
 		*(.gcc_except_table)
-
+W_RODAT		*(.rodata.*)
+R_RODAT		*(.rodata)
+R_RODAT		*(.rodata1)
+R_RODAT		*(.rodata.*)
 		/* Microblaze has .sdata and .sbss (small bss).  They must
 		   be contiguous, so please don't move any of this. JW */
 		_ssrw = . ;			



Pipes cannot be opened in binary mode:


diff -urN elf2flt-20051225.orig/flthdr.c elf2flt-20051225/flthdr.c
--- elf2flt-20051225.orig/flthdr.c	Wed Sep 28 07:26:02 2005
+++ elf2flt-20051225/flthdr.c	Sun Aug 13 02:45:21 2006
@@ -242,7 +242,7 @@
 		}
 
 		sprintf(cmd, "gunzip >> %s", tfile2);
-		tfp = popen(cmd, "wb");
+		tfp = popen(cmd, "w");
 		if(!tfp) {
 			perror("popen");
 			exit(1);
@@ -264,7 +264,7 @@
 		printf("zflat %s --> %s\n", ifile, ofile);
 		fclose(ofp);
 		sprintf(cmd, "gzip -9 -f >> %s", tfile);
-		ofp = popen(cmd, "wb");
+		ofp = popen(cmd, "w");
 		ofp_is_pipe = 1;
 	} else if (new_flags & FLAT_FLAG_GZDATA) {
 		printf("zflat-data %s --> %s\n", ifile, ofile);
@@ -272,7 +272,7 @@
 				sizeof(struct flat_hdr));
 		fclose(ofp);
 		sprintf(cmd, "gzip -9 -f >> %s", tfile);
-		ofp = popen(cmd, "wb");
+		ofp = popen(cmd, "w");
 		ofp_is_pipe = 1;
 	}
 
