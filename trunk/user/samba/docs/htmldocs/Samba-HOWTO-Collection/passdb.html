<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 10. Account Information Databases</title><link rel="stylesheet" href="samba.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.66.1"><link rel="start" href="index.html" title="The Official Samba-3 HOWTO and Reference Guide"><link rel="up" href="optional.html" title="Part III. Advanced Configuration"><link rel="prev" href="NetworkBrowsing.html" title="Chapter 9. Network Browsing"><link rel="next" href="groupmapping.html" title="Chapter 11. Group Mapping  MS Windows and UNIX"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 10. Account Information Databases</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="NetworkBrowsing.html">Prev</a> </td><th width="60%" align="center">Part III. Advanced Configuration</th><td width="20%" align="right"> <a accesskey="n" href="groupmapping.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="passdb"></a>Chapter 10. Account Information Databases</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Jelmer</span> <span class="othername">R.</span> <span class="surname">Vernooij</span></h3><div class="affiliation"><span class="orgname">The Samba Team<br></span><div class="address"><p><tt class="email">&lt;<a href="mailto:jelmer@samba.org">jelmer@samba.org</a>&gt;</tt></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">John</span> <span class="othername">H.</span> <span class="surname">Terpstra</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><tt class="email">&lt;<a href="mailto:jht@samba.org">jht@samba.org</a>&gt;</tt></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Gerald</span> <span class="othername">(Jerry)</span> <span class="surname">Carter</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><tt class="email">&lt;<a href="mailto:jerry@samba.org">jerry@samba.org</a>&gt;</tt></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jeremy</span> <span class="surname">Allison</span></h3><div class="affiliation"><span class="orgname">Samba Team<br></span><div class="address"><p><tt class="email">&lt;<a href="mailto:jra@samba.org">jra@samba.org</a>&gt;</tt></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Guenther</span> <span class="surname">Deschner</span></h3><span class="contrib">LDAP updates</span><div class="affiliation"><span class="orgname">SuSE<br></span><div class="address"><p><tt class="email">&lt;<a href="mailto:gd@suse.de">gd@suse.de</a>&gt;</tt></p></div></div></div></div><div><div class="author"><h3 class="author"><span class="firstname">Olivier (lem)</span> <span class="surname">Lemaire</span></h3><div class="affiliation"><span class="orgname">IDEALX<br></span><div class="address"><p><tt class="email">&lt;<a href="mailto:olem@IDEALX.org">olem@IDEALX.org</a>&gt;</tt></p></div></div></div></div><div><p class="pubdate">May 24, 2003</p></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="passdb.html#id2551335">Features and Benefits</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2551374">Backward Compatibility Backends</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2551482">New Backends</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#passdbtech">Technical Information</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2551882">Important Notes About Security</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2552093">Mapping User Identifiers between MS Windows and UNIX</a></span></dt><dt><span class="sect2"><a href="passdb.html#idmapbackend">Mapping Common UIDs/GIDs on Distributed Machines</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2552349">Regarding LDAP Directories and Windows Computer Accounts</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#acctmgmttools">Account Management Tools</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2552468">The <span class="emphasis"><em>smbpasswd</em></span> Command</a></span></dt><dt><span class="sect2"><a href="passdb.html#pdbeditthing">The <span class="emphasis"><em>pdbedit</em></span> Command</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#id2552970">Password Backends</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2553014">Plaintext</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2553048">smbpasswd  Encrypted Password Database</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2553152">tdbsam</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2553197">ldapsam</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2555061">MySQL</a></span></dt><dt><span class="sect2"><a href="passdb.html#XMLpassdb">XML</a></span></dt></dl></dd><dt><span class="sect1"><a href="passdb.html#id2556067">Common Errors</a></span></dt><dd><dl><dt><span class="sect2"><a href="passdb.html#id2556072">Users Cannot Logon</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2556107">Users Being Added to the Wrong Backend Database</a></span></dt><dt><span class="sect2"><a href="passdb.html#id2556202">Configuration of <i class="parameter"><tt>auth methods</tt></i></a></span></dt></dl></dd></dl></div><p>
Samba-3 implements a new capability to work concurrently with multiple account backends.
The possible new combinations of password backends allows Samba-3 a degree of flexibility
and scalability that previously could be achieved only with MS Windows Active Directory.
This chapter describes the new functionality and how to get the most out of it.
</p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2551335"></a>Features and Benefits</h2></div></div></div><p>
Samba-3 provides for complete backward compatibility with Samba-2.2.x functionality
as follows:
<a class="indexterm" name="id2551345"></a>
<a class="indexterm" name="id2551354"></a>
<a class="indexterm" name="id2551363"></a>
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2551374"></a>Backward Compatibility Backends</h3></div></div></div><div class="variablelist"><dl><dt><span class="term">Plain Text</span></dt><dd><p>
			This isn't really a backend at all, but is listed here for simplicity.  Samba can be
			configured to pass plaintext authentication requests to the traditional UNIX/Linux
			<tt class="filename">/etc/passwd</tt> and <tt class="filename">/etc/shadow</tt>
			style subsystems.  On systems that have Pluggable Authentication Modules (PAM)
			support, all PAM modules are supported. The behavior is just as it was with
			Samba-2.2.x, and the protocol limitations imposed by MS Windows clients
			apply likewise. Please refer to <a href="passdb.html#passdbtech" title="Technical Information">Technical Information</a> for more information
			regarding the limitations of Plain Text password usage.
			</p></dd><dt><span class="term">smbpasswd</span></dt><dd><p>
			This option allows continued use of the <tt class="filename">smbpasswd</tt>
			file that maintains a plain ASCII (text) layout that includes the MS Windows
			LanMan and NT encrypted passwords as well as a field that stores some
			account information. This form of password backend does not store any of
			the MS Windows NT/200x SAM (Security Account Manager) information required to
			provide the extended controls that are needed for more comprehensive 
			inter-operation with MS Windows NT4/200x servers.
			</p><p>
			This backend should be used only for backward compatibility with older
			versions of Samba. It may be deprecated in future releases.
			</p></dd><dt><span class="term">ldapsam_compat (Samba-2.2 LDAP Compatibility)</span></dt><dd><p>
			There is a password backend option that allows continued operation with
			an existing OpenLDAP backend that uses the Samba-2.2.x LDAP schema extension.
			This option is provided primarily as a migration tool, although there is
			no reason to force migration at this time. This tool will eventually
			be deprecated.
			</p></dd></dl></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2551482"></a>New Backends</h3></div></div></div><p>
Samba-3 introduces a number of new password backend capabilities.
<a class="indexterm" name="id2551491"></a>
<a class="indexterm" name="id2551500"></a>
<a class="indexterm" name="id2551510"></a>
<a class="indexterm" name="id2551519"></a>
</p><div class="variablelist"><dl><dt><span class="term">tdbsam</span></dt><dd><p>
			This backend provides a rich database backend for local servers. This
			backend is not suitable for multiple Domain Controllers (i.e., PDC + one
			or more BDC) installations.
			</p><p>
			The <span class="emphasis"><em>tdbsam</em></span> password backend stores the old <span class="emphasis"><em>
			smbpasswd</em></span> information plus the extended MS Windows NT / 200x
			SAM information into a binary format TDB (trivial database) file.
			The inclusion of the extended information makes it possible for Samba-3
			to implement the same account and system access controls that are possible
			with MS Windows NT4/200x-based systems.
			</p><p>
			The inclusion of the <span class="emphasis"><em>tdbsam</em></span> capability is a direct
			response to user requests to allow simple site operation without the overhead
			of the complexities of running OpenLDAP. It is recommended to use this only
			for sites that have fewer than 250 users. For larger sites or implementations,
			the use of OpenLDAP or of Active Directory integration is strongly recommended.
			</p></dd><dt><span class="term">ldapsam</span></dt><dd><p>
			This provides a rich directory backend for distributed account installation.	
			</p><p>
			Samba-3 has a new and extended LDAP implementation that requires configuration
			of OpenLDAP with a new format Samba schema. The new format schema file is
			included in the <tt class="filename">examples/LDAP</tt> directory of the Samba distribution.
			</p><p>
			The new LDAP implementation significantly expands the control abilities that
			were possible with prior versions of Samba. It is now possible to specify
			&#8220;<span class="quote"><span class="emphasis"><em>per user</em></span></span>&#8221; profile settings, home directories, account access controls, and
			much more. Corporate sites will see that the Samba Team has listened to their
			requests both for capability and to allow greater scalability.
			</p></dd><dt><span class="term">mysqlsam (MySQL based backend)</span></dt><dd><p>
			It is expected that the MySQL-based SAM will be very popular in some corners.
			This database backend will be of considerable interest to sites that want to
			leverage existing MySQL technology.
			</p></dd><dt><span class="term">pgsqlsam (PostGreSQL based backend)</span></dt><dd><p>
				Stores user information in a PostgreSQL database.
				This backend is largely undocumented at 
				the moment, though it's configuration is very similar to 
				that of the mysqlsam backend.
			</p></dd><dt><span class="term">xmlsam (XML based datafile)</span></dt><dd><p>
<a class="indexterm" name="id2551660"></a>
			Allows the account and password data to be stored in an XML format
			data file. This backend cannot be used for normal operation, it can only 
			be used in conjunction with <span><b class="command">pdbedit</b></span>'s pdb2pdb 
			functionality. The DTD that is used might be subject to changes in the future.
			</p><p>
			The <i class="parameter"><tt>xmlsam</tt></i> option can be useful for account migration between database
			backends or backups. Use of this tool will allow the data to be edited before migration
			into another backend format.
			</p></dd></dl></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="passdbtech"></a>Technical Information</h2></div></div></div><p>
	Old Windows clients send plain text passwords over the wire. Samba can check these
	passwords by encrypting them and comparing them to the hash stored in the UNIX user database.
	</p><p>
<a class="indexterm" name="id2551714"></a>	
	Newer Windows clients send encrypted passwords (so-called LanMan and NT hashes) over 
	the wire, instead of plain text passwords. The newest clients will send only encrypted
	passwords and refuse to send plain text passwords, unless their registry is tweaked.
	</p><p>
	These passwords can't be converted to UNIX-style encrypted passwords. Because of that,
	you can't use the standard UNIX user database, and you have to store the LanMan and NT
	hashes somewhere else.
	</p><p>
	In addition to differently encrypted passwords, Windows also stores certain data for each
	user that is not stored in a UNIX user database. For example, workstations the user may logon from,
	the location where the user's profile is stored, and so on. Samba retrieves and stores this
	information using a <a class="indexterm" name="id2551741"></a>passdb backend. Commonly available backends are LDAP, plain text
	file, and MySQL. For more information, see the man page for <tt class="filename">smb.conf</tt> regarding the 
	<a class="indexterm" name="id2551756"></a>passdb backend parameter.
	</p><div class="figure"><a name="idmap-sid2uid"></a><p class="title"><b>Figure 10.1. IDMAP: Resolution of SIDs to UIDs.</b></p><div class="mediaobject"><img src="images/idmap-sid2uid.png" width="270" alt="IDMAP: Resolution of SIDs to UIDs."></div></div><p>
<a class="indexterm" name="id2551810"></a>
	The resolution of SIDs to UIDs is fundamental to correct operation of Samba. In both cases shown, if winbindd is not running, or cannot
	be contacted, then only local SID/UID resolution is possible. See <a href="passdb.html#idmap-sid2uid" title="Figure 10.1. IDMAP: Resolution of SIDs to UIDs.">resolution of SIDs to UIDs</a> and
	<a href="passdb.html#idmap-uid2sid" title="Figure 10.2. IDMAP: Resolution of UIDs to SIDs.">resolution of UIDs to SIDs</a> diagrams.
	</p><div class="figure"><a name="idmap-uid2sid"></a><p class="title"><b>Figure 10.2. IDMAP: Resolution of UIDs to SIDs.</b></p><div class="mediaobject"><img src="images/idmap-uid2sid.png" width="270" alt="IDMAP: Resolution of UIDs to SIDs."></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2551882"></a>Important Notes About Security</h3></div></div></div><p>
		The UNIX and SMB password encryption techniques seem similar on the surface. This
		similarity is, however, only skin deep. The UNIX scheme typically sends clear-text
		passwords over the network when logging in. This is bad. The SMB encryption scheme
		never sends the clear-text password over the network but it does store the 16 byte 
		hashed values on disk. This is also bad. Why? Because the 16 byte hashed values
		are a &#8220;<span class="quote"><span class="emphasis"><em>password equivalent.</em></span></span>&#8221; You cannot derive the user's password from them, but
		they could potentially be used in a modified client to gain access to a server.
		This would require considerable technical knowledge on behalf of the attacker but
		is perfectly possible. You should thus treat the data stored in whatever passdb
		backend you use (smbpasswd file, LDAP, MYSQL) as though it contained the clear-text
		passwords of all your users. Its contents must be kept secret and the file should
		be protected accordingly.
		</p><p>
		Ideally, we would like a password scheme that involves neither plain text passwords
		on the network nor on disk. Unfortunately, this is not available as Samba is stuck with
		having to be compatible with other SMB systems (Windows NT, Windows for Workgroups, Windows 9x/Me).
		</p><p>
		Windows NT 4.0 Service Pack 3 changed the default setting so plaintext passwords
		are disabled from being sent over the wire. This mandates either the use of encrypted
		password support or editing the Windows NT registry to re-enable plaintext passwords.
		</p><p>
		The following versions of Microsoft Windows do not support full domain security protocols,
		although they may log onto a domain environment:
		</p><div class="itemizedlist"><ul type="disc"><li><p>MS DOS Network client 3.0 with the basic network redirector installed.</p></li><li><p>Windows 95 with the network redirector update installed.</p></li><li><p>Windows 98 [Second Edition].</p></li><li><p>Windows Me.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
 		MS Windows XP Home does not have facilities to become a Domain Member and it cannot participate in domain logons.
		</p></div><p>
		The following versions of MS Windows fully support domain security protocols.
		</p><div class="itemizedlist"><ul type="disc"><li><p>Windows NT 3.5x.</p></li><li><p>Windows NT 4.0.</p></li><li><p>Windows 2000 Professional.</p></li><li><p>Windows 200x Server/Advanced Server.</p></li><li><p>Windows XP Professional.</p></li></ul></div><p>
		All current releases of Microsoft SMB/CIFS clients support authentication via the
		SMB Challenge/Response mechanism described here. Enabling clear-text authentication
		does not disable the ability of the client to participate in encrypted authentication.
		Instead, it allows the client to negotiate either plain text or encrypted password
		handling.
		</p><p>
		MS Windows clients will cache the encrypted password alone. Where plain text passwords
		are re-enabled through the appropriate registry change, the plain text password is never
		cached. This means that in the event that a network connections should become disconnected
		(broken), only the cached (encrypted) password will be sent to the resource server to
		effect an auto-reconnect. If the resource server does not support encrypted passwords the
		auto-reconnect will fail. Use of encrypted passwords is strongly advised.
		</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2552019"></a>Advantages of Encrypted Passwords</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Plaintext passwords are not passed across 
				the network. Someone using a network sniffer cannot just 
				record passwords going to the SMB server.</p></li><li><p>Plaintext passwords are not stored anywhere in
				memory or on disk.</p></li><li><p>Windows NT does not like talking to a server 
				that does not support encrypted passwords. It will refuse 
				to browse the server if the server is also in User Level 
				security mode. It will insist on prompting the user for the 
				password on each connection, which is very annoying. The
				only things you can do to stop this is to use SMB encryption.
				</p></li><li><p>Encrypted password support allows automatic share
				(resource) reconnects.</p></li><li><p>Encrypted passwords are essential for PDC/BDC
				operation.</p></li></ul></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2552063"></a>Advantages of Non-Encrypted Passwords</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Plaintext passwords are not kept 
				on disk, and are not cached in memory. </p></li><li><p>Uses same password file as other UNIX 
				services such as Login and FTP.</p></li><li><p>Use of other services (such as Telnet and FTP) that
				send plain text passwords over the network, so sending them for SMB
				is not such a big deal.</p></li></ul></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2552093"></a>Mapping User Identifiers between MS Windows and UNIX</h3></div></div></div><p>
	Every operation in UNIX/Linux requires a user identifier (UID), just as in
	MS Windows NT4/200x this requires a Security Identifier (SID). Samba provides
	two means for mapping an MS Windows user to a UNIX/Linux UID.
	</p><p>
	First, all Samba SAM (Security Account Manager database) accounts require
	a UNIX/Linux UID that the account will map to. As users are added to the account
	information database, Samba will call the <a class="indexterm" name="id2552112"></a>add user script
	interface to add the account to the Samba host OS. In essence all accounts in
	the local SAM require a local user account.
	</p><p>
	<a class="indexterm" name="id2552125"></a>
	<a class="indexterm" name="id2552131"></a>
	The second way to effect Windows SID to UNIX UID mapping is via the
	<span class="emphasis"><em>idmap uid</em></span> and <span class="emphasis"><em>idmap gid</em></span> parameters in <tt class="filename">smb.conf</tt>.
	Please refer to the man page for information about these parameters.
	These parameters are essential when mapping users from a remote SAM server.
	</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="idmapbackend"></a>Mapping Common UIDs/GIDs on Distributed Machines</h3></div></div></div><p>
	Samba-3 has a special facility that makes it possible to maintain identical UIDs and GIDs
	on all servers in a distributed network. A distributed network is one where there exists
	a PDC, one or more BDCs and/or one or more Domain Member servers. Why is this important?
	This is important if files are being shared over more than one protocol (e.g., NFS) and where
	users are copying files across UNIX/Linux systems using tools such as <span><b class="command">rsync</b></span>.
	</p><p>
	<a class="indexterm" name="id2552187"></a>
	The special facility is enabled using a parameter called <i class="parameter"><tt>idmap backend</tt></i>.
	The default setting for this parameter is an empty string. Technically it is possible to use
	an LDAP based idmap backend for UIDs and GIDs, but it makes most sense when this is done for
	network configurations that also use LDAP for the SAM backend. Following
	<a href="passdb.html#idmapbackendexample" title="Example 10.1. Example configuration with the LDAP idmap backend">example</a> shows that.
	</p><p>
<a class="indexterm" name="id2552217"></a>
</p><div class="example"><a name="idmapbackendexample"></a><p class="title"><b>Example 10.1. Example configuration with the LDAP idmap backend</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2552249"></a><i class="parameter"><tt>
					
				idmap backend = ldap:ldap://ldap-server.quenya.org:636</tt></i></td></tr><tr><td># Alternately, this could be specified as:</td></tr><tr><td><a class="indexterm" name="id2552272"></a><i class="parameter"><tt>
					
				idmap backend = ldap:ldaps://ldap-server.quenya.org</tt></i></td></tr></table></div><p>
	</p><p>
	A network administrator who wants to make significant use of LDAP backends will sooner or later be
	exposed to the excellent work done by PADL Software. PADL <a href="http://www.padl.com" target="_top">http://www.padl.com</a> have
	produced and released to open source an array of tools that might be of interest. These tools include:
	</p><div class="itemizedlist"><ul type="disc"><li><p>
		<span class="emphasis"><em>nss_ldap:</em></span> An LDAP Name Service Switch module to provide native
		name service support for AIX, Linux, Solaris, and other operating systems. This tool
		can be used for centralized storage and retrieval of UIDs/GIDs.
		</p></li><li><p>
		<span class="emphasis"><em>pam_ldap:</em></span> A PAM module that provides LDAP integration for UNIX/Linux
		system access authentication.
		</p></li><li><p>
		<span class="emphasis"><em>idmap_ad:</em></span> An IDMAP backend that supports the Microsoft Services for
		UNIX RFC 2307 schema available from the PADL web 
		<a href="http://www.padl.com/download/xad_oss_plugins.tar.gz" target="_top">site</a>.
		</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2552349"></a>Regarding LDAP Directories and Windows Computer Accounts</h3></div></div></div><p>
		Samba doesn't provide a turnkey solution to LDAP. It is best to deal with the design and configuration
		of an LDAP directory prior to integration with Samba. A working knowledge of LDAP makes Samba integration
		easy and the lack of a working knowledge of LDAP can make it one a frustrating experience.
		</p><p>
		Computer (machine) accounts can be placed where ever you like in an LDAP directory subject to some
		constraints that are described in this chapter.
		</p><p>
		The POSIX and SambaSAMAccount components of computer (machine) accounts are both used by Samba.
		i.e.: Machine  accounts are treated inside Samba in the same way that Windows NT4/200X treats
		them. A user account and a machine account are indistinquishable from each other, except that
		the machine account ends in a '$' character, as do trust accounts.
		</p><p>
		The need for Windows user, group, machine, trust, etc. accounts to be tied to a valid UNIX uid
		is a design decision that was made a long way back in the history of Samba development. It is
		unlikely that this decision will be reversed of changed during the remaining life of the
		Samba-3.x series.
		</p><p>
		The resolution of a UID from the Windows SID is achieved within Samba through a mechanism that
		must refer back to the host operating system on which Samba is running. The Name Service
		Switcher (NSS) is the preferred mechanism that shields applications (like Samba) from the
		need to know everything about every host OS it runs on.
		</p><p>
		Samba asks the host OS to provide a UID via the &#8220;<span class="quote"><span class="emphasis"><em>passwd</em></span></span>&#8221;, &#8220;<span class="quote"><span class="emphasis"><em>shadow</em></span></span>&#8221;
		and &#8220;<span class="quote"><span class="emphasis"><em>group</em></span></span>&#8221; facilities in the NSS control (configuration) file. The best tool
		for achieving this is left up to the UNIX administrator to determine. It is not imposed by
		Samba. Samba provides winbindd together with its support libraries as one method. It is
		possible to do this via LDAP - and for that Samba provides the appropriate hooks so that
		all account entities can be located in an LDAP directory.
		</p><p>
		For many the weapon of choice is to use the PADL nss_ldap utility. This utility must
		be configured so that computer accounts can be resolved to a POSIX/UNIX account UID. That
		is fundamentally an LDAP design question.  The information provided on the Samba list and
		in the documentation is directed at providing working examples only. The design
		of an LDAP directory is a complex subject that is beyond the scope of this documentation.
		</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="acctmgmttools"></a>Account Management Tools</h2></div></div></div><p>
<a class="indexterm" name="id2552447"></a>
Samba provides two tools for management of user and machine accounts. These tools are
called <span><b class="command">smbpasswd</b></span> and <span><b class="command">pdbedit</b></span>. 
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2552468"></a>The <span class="emphasis"><em>smbpasswd</em></span> Command</h3></div></div></div><p>
		The smbpasswd utility is similar to the <span><b class="command">passwd</b></span>
		or <span><b class="command">yppasswd</b></span> programs. It maintains the two 32 byte password
		fields in the passdb backend.
		</p><p>
		<span><b class="command">smbpasswd</b></span> works in a client-server mode where it contacts the
		local smbd to change the user's password on its behalf. This has enormous benefits.
		</p><p>
		<span><b class="command">smbpasswd</b></span> has the capability to change passwords on Windows NT
		servers (this only works when the request is sent to the NT Primary Domain Controller
		if changing an NT Domain user's password).
		</p><p>
		<span><b class="command">smbpasswd</b></span> can be used to:
<a class="indexterm" name="id2552526"></a>
<a class="indexterm" name="id2552533"></a>
		
		</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>add</em></span> user or machine accounts.</p></li><li><p><span class="emphasis"><em>delete</em></span> user or machine accounts.</p></li><li><p><span class="emphasis"><em>enable</em></span> user or machine accounts.</p></li><li><p><span class="emphasis"><em>disable</em></span> user or machine accounts.</p></li><li><p><span class="emphasis"><em>set to NULL</em></span> user passwords.</p></li><li><p><span class="emphasis"><em>manage interdomain trust accounts.</em></span></p></li></ul></div><p>
		To run smbpasswd as a normal user just type:
		</p><p>
</p><pre class="screen">
<tt class="prompt">$ </tt><b class="userinput"><tt>smbpasswd</tt></b>
<tt class="prompt">Old SMB password: </tt><b class="userinput"><tt><i class="replaceable"><tt>secret</tt></i></tt></b>
</pre><p>
		For <i class="replaceable"><tt>secret</tt></i>, type old value here or press return if
		there is no old password.
</p><pre class="screen">
<tt class="prompt">New SMB Password: </tt><b class="userinput"><tt><i class="replaceable"><tt>new secret</tt></i></tt></b>
<tt class="prompt">Repeat New SMB Password: </tt><b class="userinput"><tt><i class="replaceable"><tt>new secret</tt></i></tt></b>
</pre><p>
		</p><p>
		If the old value does not match the current value stored for that user, or the two
		new values do not match each other, then the password will not be changed.
		</p><p>
		When invoked by an ordinary user, the command will only allow the user to change his or her own
		SMB password.
		</p><p>
		When run by root, <span><b class="command">smbpasswd</b></span> may take an optional argument specifying
		the user name whose SMB password you wish to change. When run as root, <span><b class="command">smbpasswd</b></span>
		does not prompt for or check the old password value, thus allowing root to set passwords 
		for users who have forgotten their passwords.
		</p><p>
		<span><b class="command">smbpasswd</b></span> is designed to work in the way familiar to UNIX
		users who use the <span><b class="command">passwd</b></span> or <span><b class="command">yppasswd</b></span> commands.
		While designed for administrative use, this tool provides essential User Level
		password change capabilities.
		</p><p>
		For more details on using <span><b class="command">smbpasswd</b></span>, refer to the man page (the
		definitive reference).
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="pdbeditthing"></a>The <span class="emphasis"><em>pdbedit</em></span> Command</h3></div></div></div><p>
<a class="indexterm" name="id2552740"></a>
		<span><b class="command">pdbedit</b></span> is a tool that can be used only by root. It is used to
		manage the passdb backend. <span><b class="command">pdbedit</b></span> can be used to:
<a class="indexterm" name="id2552760"></a>
<a class="indexterm" name="id2552767"></a>

		</p><div class="itemizedlist"><ul type="disc"><li><p>add, remove or modify user accounts.</p></li><li><p>list user accounts.</p></li><li><p>migrate user accounts.</p></li></ul></div><p>
<a class="indexterm" name="id2552798"></a>
		The <span><b class="command">pdbedit</b></span> tool is the only one that can manage the account
		security and policy settings. It is capable of all operations that smbpasswd can
		do as well as a super set of them.
		</p><p>
<a class="indexterm" name="id2552817"></a>
		One particularly important purpose of the <span><b class="command">pdbedit</b></span> is to allow
		the migration of account information from one passdb backend to another. See the
		<a href="passdb.html#XMLpassdb" title="XML">XML</a> password backend section of this chapter.
		</p><p>
		The following is an example of the user account information that is stored in
		a tdbsam password backend. This listing was produced by running:
		</p><pre class="screen">
<tt class="prompt">$ </tt><b class="userinput"><tt>pdbedit -Lv met</tt></b>
UNIX username:        met
NT username:
Account Flags:        [UX         ]
User SID:             S-1-5-21-1449123459-1407424037-3116680435-2004
Primary Group SID:    S-1-5-21-1449123459-1407424037-3116680435-1201
Full Name:            Melissa E Terpstra
Home Directory:       \\frodo\met\Win9Profile
HomeDir Drive:        H:
Logon Script:         scripts\logon.bat
Profile Path:         \\frodo\Profiles\met
Domain:               MIDEARTH
Account desc:
Workstations:         melbelle
Munged dial:
Logon time:           0
Logoff time:          Mon, 18 Jan 2038 20:14:07 GMT
Kickoff time:         Mon, 18 Jan 2038 20:14:07 GMT
Password last set:    Sat, 14 Dec 2002 14:37:03 GMT
Password can change:  Sat, 14 Dec 2002 14:37:03 GMT
Password must change: Mon, 18 Jan 2038 20:14:07 GMT
</pre><p>
<a class="indexterm" name="id2552878"></a>
		The <span><b class="command">pdbedit</b></span> tool allows migration of authentication (account)
		databases from one backend to another. For example: To migrate accounts from an
		old <tt class="filename">smbpasswd</tt> database to a <i class="parameter"><tt>tdbsam</tt></i>
		backend:
		</p><div class="procedure"><ol type="1"><li><p>
			Set the <a class="indexterm" name="id2552915"></a>passdb backend = tdbsam, smbpasswd.
			</p></li><li><p>
			Execute:
</p><pre class="screen">
<tt class="prompt">root# </tt><b class="userinput"><tt>pdbedit -i smbpasswd -e tdbsam</tt></b>
</pre><p>
			</p></li><li><p>
			Now remove the <i class="parameter"><tt>smbpasswd</tt></i> from the passdb backend
			configuration in <tt class="filename">smb.conf</tt>.
			</p></li></ol></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2552970"></a>Password Backends</h2></div></div></div><p>
Samba offers the greatest flexibility in backend account database design of any SMB/CIFS server
technology available today. The flexibility is immediately obvious as one begins to explore this
capability.
</p><p>
It is possible to specify not only multiple different password backends, but even multiple
backends of the same type. For example, to use two different tdbsam databases:
</p><p>
</p><table class="simplelist" border="0" summary="Simple list"><tr><td><a class="indexterm" name="id2552996"></a><i class="parameter"><tt>
					
				passdb backend = tdbsam:/etc/samba/passdb.tdb tdbsam:/etc/samba/old-passdb.tdb</tt></i></td></tr></table><p>
</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2553014"></a>Plaintext</h3></div></div></div><p>
		Older versions of Samba retrieved user information from the UNIX user database 
		and eventually some other fields from the file <tt class="filename">/etc/samba/smbpasswd</tt>
		or <tt class="filename">/etc/smbpasswd</tt>. When password encryption is disabled, no 
		SMB specific data is stored at all. Instead all operations are conducted via the way
		that the Samba host OS will access its <tt class="filename">/etc/passwd</tt> database.
		Linux systems For example, all operations are done via PAM.
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2553048"></a>smbpasswd  Encrypted Password Database</h3></div></div></div><p>
<a class="indexterm" name="id2553059"></a>
		Traditionally, when configuring <a class="indexterm" name="id2553069"></a>encrypt passwords = yes in Samba's <tt class="filename">smb.conf</tt> file, user account
		information such as username, LM/NT password hashes, password change times, and account
		flags have been stored in the <tt class="filename">smbpasswd(5)</tt> file. There are several
		disadvantages to this approach for sites with large numbers of users (counted
		in the thousands).
		</p><div class="itemizedlist"><ul type="disc"><li><p>
		The first problem is that all lookups must be performed sequentially. Given that
		there are approximately two lookups per domain logon (one for a normal
		session connection such as when mapping a network drive or printer), this
		is a performance bottleneck for large sites. What is needed is an indexed approach
		such as used in databases.
		</p></li><li><p>
		The second problem is that administrators who desire to replicate a smbpasswd file
		to more than one Samba server were left to use external tools such as
		<span><b class="command">rsync(1)</b></span> and <span><b class="command">ssh(1)</b></span> and wrote custom,
		in-house scripts.
		</p></li><li><p>
		Finally, the amount of information that is stored in an smbpasswd entry leaves
		no room for additional attributes such as a home directory, password expiration time,
		or even a Relative Identifier (RID).
		</p></li></ul></div><p>
		As a result of these deficiencies, a more robust means of storing user attributes
		used by smbd was developed. The API which defines access to user accounts
		is commonly referred to as the samdb interface (previously this was called the passdb
		API, and is still so named in the Samba CVS trees). 
		</p><p>
		Samba provides an enhanced set of passdb backends that overcome the deficiencies
		of the smbpasswd plain text database. These are tdbsam, ldapsam and xmlsam.
		Of these, ldapsam will be of most interest to large corporate or enterprise sites.
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2553152"></a>tdbsam</h3></div></div></div><p>
<a class="indexterm" name="id2553159"></a>
		Samba can store user and machine account data in a &#8220;<span class="quote"><span class="emphasis"><em>TDB</em></span></span>&#8221; (Trivial Database).
		Using this backend does not require any additional configuration. This backend is
		recommended for new installations that do not require LDAP.
		</p><p>
		As a general guide, the Samba Team does not recommend using the tdbsam backend for sites
		that have 250 or more users. Additionally, tdbsam is not capable of scaling for use
		in sites that require PDB/BDC implementations that require replication of the account
		database. Clearly, for reason of scalability, the use of ldapsam should be encouraged.
		</p><p>
		The recommendation of a 250 user limit is purely based on the notion that this
		would generally involve a site that has routed networks, possibly spread across
		more than one physical location. The Samba Team has not at this time established
		the performance based scalability limits of the tdbsam architecture.
		</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2553197"></a>ldapsam</h3></div></div></div><p>
<a class="indexterm" name="id2553205"></a>
		There are a few points to stress that the ldapsam does not provide. The LDAP
		support referred to in this documentation does not include:
		</p><div class="itemizedlist"><ul type="disc"><li><p>A means of retrieving user account information from
			an Windows 200x Active Directory server.</p></li><li><p>A means of replacing /etc/passwd.</p></li></ul></div><p>
		The second item can be accomplished by using LDAP NSS and PAM modules. LGPL
		versions of these libraries can be obtained from 
		<a href="http://www.padl.com/" target="_top">PADL Software</a>.
		More information about the configuration of these packages may be found at
		<a href="http://safari.oreilly.com/?XmlId=1-56592-491-6" target="_top">
		<span class="emphasis"><em>LDAP, System Administration</em></span>; Gerald Carter by O'Reilly; Chapter 6: Replacing NIS."</a>
		</p><p>
		This document describes how to use an LDAP directory for storing Samba user
		account information traditionally stored in the smbpasswd(5) file. It is
		assumed that the reader already has a basic understanding of LDAP concepts
		and has a working directory server already installed. For more information
		on LDAP architectures and directories, please refer to the following sites:
		</p><div class="itemizedlist"><ul type="disc"><li><p><a href="http://www.openldap.org/" target="_top">OpenLDAP</a></p></li><li><p><a href="http://iplanet.netscape.com/directory" target="_top">Sun iPlanet Directory Server</a></p></li></ul></div><p>
		Two additional Samba resources which may prove to be helpful are:
		</p><div class="itemizedlist"><ul type="disc"><li><p>The <a href="http://www.unav.es/cti/ldap-smb/ldap-smb-3-howto.html" target="_top">Samba-PDC-LDAP-HOWTO</a>
			maintained by Ignacio Coupeau.</p></li><li><p>The NT migration scripts from <a href="http://samba.idealx.org/" target="_top">IDEALX</a> that are
			geared to manage users and group in such a Samba-LDAP Domain Controller configuration.
			</p></li></ul></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2553318"></a>Supported LDAP Servers</h4></div></div></div><p>
			The LDAP ldapsam code has been developed and tested using the OpenLDAP 2.0 and 2.1 server and
			client libraries. The same code should work with Netscape's Directory Server and client SDK.
			However, there are bound to be compile errors and bugs. These should not be hard to fix.
			Please submit fixes via the process outlined in <a href="bugreport.html" title="Chapter 37. Reporting Bugs">Reporting Bugs</a> chapter.
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2553342"></a>Schema and Relationship to the RFC 2307 posixAccount</h4></div></div></div><p>
			Samba-3.0 includes the necessary schema file for OpenLDAP 2.0 in
			<tt class="filename">examples/LDAP/samba.schema</tt>. The sambaSamAccount ObjectClass is given here:
			</p><p>
</p><pre class="programlisting">
ObjectClass (1.3.6.1.4.1.7165.2.2.6 NAME 'sambaSamAccount' SUP top AUXILIARY
    DESC 'Samba-3.0 Auxiliary SAM Account'
    MUST ( uid $ sambaSID )
    MAY  ( cn $ sambaLMPassword $ sambaNTPassword $ sambaPwdLastSet $
          sambaLogonTime $ sambaLogoffTime $ sambaKickoffTime $
          sambaPwdCanChange $ sambaPwdMustChange $ sambaAcctFlags $
          displayName $ sambaHomePath $ sambaHomeDrive $ sambaLogonScript $
          sambaProfilePath $ description $ sambaUserWorkstations $
          sambaPrimaryGroupSID $ sambaDomainName ))
</pre><p>
</p><p>
			The <tt class="filename">samba.schema</tt> file has been formatted for OpenLDAP 2.0/2.1.
			The Samba Team owns the OID space used by the above schema and recommends its use.
			If you translate the schema to be used with Netscape DS, please submit the modified
			schema file as a patch to <a href="mailto:jerry@samba.org" target="_top">jerry@samba.org</a>.
			</p><p>
			Just as the smbpasswd file is meant to store information that provides information additional to  a
			user's <tt class="filename">/etc/passwd</tt> entry, so is the sambaSamAccount object
			meant to supplement the UNIX user account information. A sambaSamAccount is a
			<tt class="constant">AUXILIARY</tt> ObjectClass so it can be used to augment existing
			user account information in the LDAP directory, thus providing information needed
			for Samba account handling. However, there are several fields (e.g., uid) that overlap
			with the posixAccount ObjectClass outlined in RFC2307. This is by design.
			</p><p>
			In order to store all user account information (UNIX and Samba) in the directory,
			it is necessary to use the sambaSamAccount and posixAccount ObjectClass es in
			combination. However, smbd will still obtain the user's UNIX account
			information via the standard C library calls (e.g., getpwnam(), et al).
			This means that the Samba server must also have the LDAP NSS library installed
			and functioning correctly. This division of information makes it possible to
			store all Samba account information in LDAP, but still maintain UNIX account
			information in NIS while the network is transitioning to a full LDAP infrastructure.
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2553450"></a>OpenLDAP Configuration</h4></div></div></div><p>
			To include support for the sambaSamAccount object in an OpenLDAP directory
			server, first copy the samba.schema file to slapd's configuration directory.
			The samba.schema file can be found in the directory <tt class="filename">examples/LDAP</tt>
			in the Samba source distribution.
			</p><p>
</p><pre class="screen">
<tt class="prompt">root# </tt><b class="userinput"><tt>cp samba.schema /etc/openldap/schema/</tt></b>
</pre><p>
</p><p>
			Next, include the <tt class="filename">samba.schema</tt> file in <tt class="filename">slapd.conf</tt>.
			The sambaSamAccount object contains two attributes that depend on other schema
			files. The <i class="parameter"><tt>uid</tt></i> attribute is defined in <tt class="filename">cosine.schema</tt> and
			the <i class="parameter"><tt>displayName</tt></i> attribute is defined in the <tt class="filename">inetorgperson.schema</tt>
			file. Both of these must be included before the <tt class="filename">samba.schema</tt> file.
			</p><p>
</p><pre class="programlisting">
## /etc/openldap/slapd.conf

## schema files (core.schema is required by default)
include	           /etc/openldap/schema/core.schema

## needed for sambaSamAccount
include            /etc/openldap/schema/cosine.schema
include            /etc/openldap/schema/inetorgperson.schema
include            /etc/openldap/schema/nis.schema
include            /etc/openldap/schema/samba.schema
....
</pre><p>
</p><p>
		It is recommended that you maintain some indices on some of the most useful attributes,
		as in the following example, to speed up searches made on sambaSamAccount objectclasses
		(and possibly posixAccount and posixGroup as well):
		</p><p>
</p><pre class="programlisting">
# Indices to maintain
## required by OpenLDAP
index objectclass             eq

index cn                      pres,sub,eq
index sn                      pres,sub,eq
## required to support pdb_getsampwnam
index uid                     pres,sub,eq
## required to support pdb_getsambapwrid()
index displayName             pres,sub,eq

## uncomment these if you are storing posixAccount and
## posixGroup entries in the directory as well
##index uidNumber               eq
##index gidNumber               eq
##index memberUid               eq

index   sambaSID              eq
index   sambaPrimaryGroupSID  eq
index   sambaDomainName       eq
index   default               sub
</pre><p>
</p><p>
		Create the new index by executing:
		</p><p>
</p><pre class="screen">
<tt class="prompt">root# </tt>./sbin/slapindex -f slapd.conf
</pre><p>
</p><p>
		Remember to restart slapd after making these changes:
		</p><p>
</p><pre class="screen">
<tt class="prompt">root# </tt><b class="userinput"><tt>/etc/init.d/slapd restart</tt></b>
</pre><p>
</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2553625"></a>Initialize the LDAP Database</h4></div></div></div><p>
		Before you can add accounts to the LDAP database you must create the account containers
		that they will be stored in. The following LDIF file should be modified to match your
		needs (DNS entries, and so on):
		</p><p>
	
</p><pre class="programlisting">
# Organization for Samba Base
dn: dc=quenya,dc=org
objectclass: dcObject
objectclass: organization
dc: quenya
o: Quenya Org Network
description: The Samba-3 Network LDAP Example

# Organizational Role for Directory Management
dn: cn=Manager,dc=quenya,dc=org
objectclass: organizationalRole
cn: Manager
description: Directory Manager

# Setting up container for users
dn: ou=People,dc=quenya,dc=org
objectclass: top
objectclass: organizationalUnit
ou: People

# Setting up admin handle for People OU
dn: cn=admin,ou=People,dc=quenya,dc=org
cn: admin
objectclass: top
objectclass: organizationalRole
objectclass: simpleSecurityObject
userPassword: {SSHA}c3ZM9tBaBo9autm1dL3waDS21+JSfQVz

# Setting up container for groups
dn: ou=Groups,dc=quenya,dc=org
objectclass: top
objectclass: organizationalUnit
ou: Groups

# Setting up admin handle for Groups OU
dn: cn=admin,ou=Groups,dc=quenya,dc=org
cn: admin
objectclass: top
objectclass: organizationalRole
objectclass: simpleSecurityObject
userPassword: {SSHA}c3ZM9tBaBo9autm1dL3waDS21+JSfQVz

# Setting up container for computers
dn: ou=Computers,dc=quenya,dc=org
objectclass: top
objectclass: organizationalUnit
ou: Computers

# Setting up admin handle for Computers OU
dn: cn=admin,ou=Computers,dc=quenya,dc=org
cn: admin
objectclass: top
objectclass: organizationalRole
objectclass: simpleSecurityObject
userPassword: {SSHA}c3ZM9tBaBo9autm1dL3waDS21+JSfQVz
</pre><p>

</p><p>
		The userPassword shown above should be generated using <span><b class="command">slappasswd</b></span>.
		</p><p>
		The following command will then load the contents of the LDIF file into the LDAP
		database.
		</p><p>
</p><pre class="screen">
<tt class="prompt">$ </tt><b class="userinput"><tt>slapadd -v -l initldap.dif</tt></b>
</pre><p>
</p><p>
		Do not forget to secure your LDAP server with an adequate access control list
		as well as an admin password.
		</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
		Before Samba can access the LDAP server you need to store the LDAP admin password
		into the Samba-3 <tt class="filename">secrets.tdb</tt> database by:
</p><pre class="screen">
<tt class="prompt">root# </tt><b class="userinput"><tt>smbpasswd -w <i class="replaceable"><tt>secret</tt></i></tt></b>
</pre><p>
		</p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2553767"></a>Configuring Samba</h4></div></div></div><p>
			The following parameters are available in smb.conf only if your
			version of Samba was built with LDAP support. Samba automatically builds with LDAP support if the
			LDAP libraries are found.
			</p><p>LDAP related smb.conf options: 
			<a class="indexterm" name="id2553782"></a>passdb backend = ldapsam:url,
			<a class="indexterm" name="id2553790"></a>ldap admin dn,
			<a class="indexterm" name="id2553797"></a>ldap delete dn,
			<a class="indexterm" name="id2553804"></a>ldap filter,
			<a class="indexterm" name="id2553812"></a>ldap group suffix,
			<a class="indexterm" name="id2553819"></a>ldap idmap suffix,
			<a class="indexterm" name="id2553827"></a>ldap machine suffix,
			<a class="indexterm" name="id2553834"></a>ldap passwd sync,
			<a class="indexterm" name="id2553842"></a>ldap ssl,
			<a class="indexterm" name="id2553849"></a>ldap suffix,
			<a class="indexterm" name="id2553856"></a>ldap user suffix,
		</p><p>
			These are described in the <tt class="filename">smb.conf</tt> man
			page and so will not be repeated here. However, a <a href="passdb.html#confldapex" title="Example 10.2. Configuration with LDAP">sample <tt class="filename">smb.conf</tt> file</a> for
			use with an LDAP directory could appear as shown below.
			</p><p>
</p><div class="example"><a name="confldapex"></a><p class="title"><b>Example 10.2. Configuration with LDAP</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2553914"></a><i class="parameter"><tt>
					
				security = user</tt></i></td></tr><tr><td><a class="indexterm" name="id2553930"></a><i class="parameter"><tt>
					
				encrypt passwords = yes</tt></i></td></tr><tr><td><a class="indexterm" name="id2553946"></a><i class="parameter"><tt>
					
				netbios name = MORIA</tt></i></td></tr><tr><td><a class="indexterm" name="id2553961"></a><i class="parameter"><tt>
					
				workgroup = NOLDOR</tt></i></td></tr><tr><td># ldap related parameters</td></tr><tr><td># define the DN to use when binding to the directory servers</td></tr><tr><td># The password for this DN is not stored in smb.conf. Rather it</td></tr><tr><td># must be set by using 'smbpasswd -w secretpw' to store the</td></tr><tr><td># passphrase in the secrets.tdb file. If the "ldap admin dn" values</td></tr><tr><td># change, this password will need to be reset.</td></tr><tr><td><a class="indexterm" name="id2554019"></a><i class="parameter"><tt>
					
				ldap admin dn = "cn=Manager,dc=quenya,dc=org"</tt></i></td></tr><tr><td># Define the SSL option when connecting to the directory</td></tr><tr><td># ('off', 'start tls', or 'on' (default))</td></tr><tr><td><a class="indexterm" name="id2554048"></a><i class="parameter"><tt>
					
				ldap ssl = start tls</tt></i></td></tr><tr><td># syntax: passdb backend = ldapsam:ldap://server-name[:port]</td></tr><tr><td><a class="indexterm" name="id2554070"></a><i class="parameter"><tt>
					
				passdb backend = ldapsam:ldap://frodo.quenya.org</tt></i></td></tr><tr><td># smbpasswd -x delete the entire dn-entry</td></tr><tr><td><a class="indexterm" name="id2554093"></a><i class="parameter"><tt>
					
				ldap delete dn = no</tt></i></td></tr><tr><td># the machine and user suffix added to the base suffix</td></tr><tr><td># wrote WITHOUT quotes. NULL suffixes by default</td></tr><tr><td><a class="indexterm" name="id2554122"></a><i class="parameter"><tt>
					
				ldap user suffix = ou=People</tt></i></td></tr><tr><td><a class="indexterm" name="id2554137"></a><i class="parameter"><tt>
					
				ldap group suffix = ou=Groups</tt></i></td></tr><tr><td><a class="indexterm" name="id2554152"></a><i class="parameter"><tt>
					
				ldap machine suffix = ou=Computers</tt></i></td></tr><tr><td># Trust UNIX account information in LDAP</td></tr><tr><td>#  (see the smb.conf man page for details)</td></tr><tr><td>#  specify the base DN to use when searching the directory</td></tr><tr><td><a class="indexterm" name="id2554189"></a><i class="parameter"><tt>
					
				ldap suffix = dc=quenya,dc=org</tt></i></td></tr><tr><td>#  generally the default ldap search filter is ok</td></tr><tr><td><a class="indexterm" name="id2554210"></a><i class="parameter"><tt>
					
				ldap filter = (uid=%u)</tt></i></td></tr></table></div><p>
</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2554227"></a>Accounts and Groups Management</h4></div></div></div><p>
<a class="indexterm" name="id2554235"></a>
<a class="indexterm" name="id2554242"></a>

			As user accounts are managed through the sambaSamAccount objectclass, you should
			modify your existing administration tools to deal with sambaSamAccount attributes.
			</p><p>
			Machine accounts are managed with the sambaSamAccount objectclass, just
			like users accounts. However, it is up to you to store those accounts
			in a different tree of your LDAP namespace. You should use
			&#8220;<span class="quote"><span class="emphasis"><em>ou=Groups,dc=quenya,dc=org</em></span></span>&#8221; to store groups and
			&#8220;<span class="quote"><span class="emphasis"><em>ou=People,dc=quenya,dc=org</em></span></span>&#8221; to store users. Just configure your
			NSS and PAM accordingly (usually, in the <tt class="filename">/etc/openldap/sldap.conf</tt>
			configuration file).
			</p><p>
			In Samba-3, the group management system is based on POSIX
			groups. This means that Samba makes use of the posixGroup objectclass.
			For now, there is no NT-like group system management (global and local
			groups). Samba-3 knows only about <tt class="constant">Domain Groups</tt>
			and, unlike MS Windows 2000 and Active Directory, Samba-3 does not
			support nested groups. 
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2554295"></a>Security and sambaSamAccount</h4></div></div></div><p>
			There are two important points to remember when discussing the security
			of sambaSamAccount entries in the directory.
			</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Never</em></span> retrieve the SambaLMPassword or
				SambaNTPassword attribute values over an unencrypted LDAP session.</p></li><li><p><span class="emphasis"><em>Never</em></span> allow non-admin users to
				view the SambaLMPassword or SambaNTPassword attribute values.</p></li></ul></div><p>
			These password hashes are clear-text equivalents and can be used to impersonate
			the user without deriving the original clear-text strings. For more information
			on the details of LM/NT password hashes, refer to the
			<a href="passdb.html" title="Chapter 10. Account Information Databases">Account Information Database</a> section of this chapter.
			</p><p>
			To remedy the first security issue, the <a class="indexterm" name="id2554345"></a>ldap ssl <tt class="filename">smb.conf</tt> parameter defaults
			to require an encrypted session (<a class="indexterm" name="id2554358"></a>ldap ssl = on) using
			the default port of <tt class="constant">636</tt>
			when contacting the directory server. When using an OpenLDAP server, it
			is possible to use the StartTLS LDAP extended  operation in the place of
			LDAPS. In either case, you are strongly discouraged to disable this security
			(<a class="indexterm" name="id2554373"></a>ldap ssl = off).
			</p><p>
			Note that the LDAPS protocol is deprecated in favor of the LDAPv3 StartTLS
			extended operation. However, the OpenLDAP library still provides support for
			the older method of securing communication between clients and servers.
			</p><p>
			The second security precaution is to prevent non-administrative users from
			harvesting password hashes from the directory. This can be done using the
			following ACL in <tt class="filename">slapd.conf</tt>:
			</p><p>
</p><pre class="programlisting">
## allow the "ldap admin dn" access, but deny everyone else
access to attrs=SambaLMPassword,SambaNTPassword
     by dn="cn=Samba Admin,ou=People,dc=quenya,dc=org" write
     by * none
</pre><p>
</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2554414"></a>LDAP Special Attributes for sambaSamAccounts</h4></div></div></div><p> The sambaSamAccount objectclass is composed of the attributes shown in next tables: <a href="passdb.html#attribobjclPartA" title="Table 10.1. Attributes in the sambaSamAccount objectclass (LDAP)  Part A">Part A</a>, and <a href="passdb.html#attribobjclPartB" title="Table 10.2. Attributes in the sambaSamAccount objectclass (LDAP)  Part B">Part B</a>. 
			</p><p>
			</p><div class="table"><a name="attribobjclPartA"></a><p class="title"><b>Table 10.1. Attributes in the sambaSamAccount objectclass (LDAP)  Part A</b></p><table summary="Attributes in the sambaSamAccount objectclass (LDAP)  Part A" border="1"><colgroup><col align="left"><col align="justify"></colgroup><tbody><tr><td align="justify"><tt class="constant">sambaLMPassword</tt></td><td align="justify">The LANMAN password 16-byte hash stored as a character
						representation of a hexadecimal string.</td></tr><tr><td align="justify"><tt class="constant">sambaNTPassword</tt></td><td align="justify">The NT password hash 16-byte stored as a character
						representation of a hexadecimal string.</td></tr><tr><td align="justify"><tt class="constant">sambaPwdLastSet</tt></td><td align="justify">The integer time in seconds since 1970 when the
						<tt class="constant">sambaLMPassword</tt> and <tt class="constant">sambaNTPassword</tt> attributes were last set.
				</td></tr><tr><td align="justify"><tt class="constant">sambaAcctFlags</tt></td><td align="justify">String of 11 characters surrounded by square brackets []
						representing account flags such as U (user), W (workstation), X (no password expiration),
						I (Domain trust account), H (Home dir required), S (Server trust account),
						and D (disabled).</td></tr><tr><td align="justify"><tt class="constant">sambaLogonTime</tt></td><td align="justify">Integer value currently unused</td></tr><tr><td align="justify"><tt class="constant">sambaLogoffTime</tt></td><td align="justify">Integer value currently unused</td></tr><tr><td align="justify"><tt class="constant">sambaKickoffTime</tt></td><td align="justify">Specifies the time (UNIX time format) when the user
				will be locked down and cannot login any longer. If this attribute is omitted, then the account will never expire.
				If you use this attribute together with `shadowExpire' of the `shadowAccount' objectClass, will enable accounts to	
				expire completely on an exact date.</td></tr><tr><td align="justify"><tt class="constant">sambaPwdCanChange</tt></td><td align="justify">Specifies the time (UNIX time format) from which on the user is allowed to
				change his password. If attribute is not set, the user will be free to change his password whenever he wants.</td></tr><tr><td align="justify"><tt class="constant">sambaPwdMustChange</tt></td><td align="justify">Specifies the time (UNIX time format) since when the user is
				forced to change his password. If this value is set to `0', the user will have to change his password at first login.
				If this attribute is not set, then the password will never expire.</td></tr><tr><td align="justify"><tt class="constant">sambaHomeDrive</tt></td><td align="justify">Specifies the drive letter to which to map the
				UNC path specified by sambaHomePath. The drive letter must be specified in the form &#8220;<span class="quote"><span class="emphasis"><em>X:</em></span></span>&#8221;
				where X is the letter of the drive to map. Refer to the &#8220;<span class="quote"><span class="emphasis"><em>logon drive</em></span></span>&#8221; parameter in the
				smb.conf(5) man page for more information.</td></tr><tr><td align="justify"><tt class="constant">sambaLogonScript</tt></td><td align="justify">The sambaLogonScript property specifies the path of
				the user's logon script, .CMD, .EXE, or .BAT file. The string can be null. The path
				is relative to the netlogon share. Refer to the <a class="indexterm" name="id2554613"></a>logon script parameter in the
				<tt class="filename">smb.conf</tt> man page for more information.</td></tr><tr><td align="justify"><tt class="constant">sambaProfilePath</tt></td><td align="justify">Specifies a path to the user's profile.
				This value can be a null string, a local absolute path, or a UNC path. Refer to the
				<a class="indexterm" name="id2554638"></a>logon path parameter in the <tt class="filename">smb.conf</tt> man page for more information.</td></tr><tr><td align="justify"><tt class="constant">sambaHomePath</tt></td><td align="justify">The sambaHomePath property specifies the path of
				the home directory for the user. The string can be null. If sambaHomeDrive is set and specifies
				a drive letter, sambaHomePath should be a UNC path. The path must be a network
				UNC path of the form <tt class="filename">\\server\share\directory</tt>. This value can be a null string.
				Refer to the <span><b class="command">logon home</b></span> parameter in the <tt class="filename">smb.conf</tt> man page for more information.
				</td></tr></tbody></table></div><p>
			</p><p>
			</p><div class="table"><a name="attribobjclPartB"></a><p class="title"><b>Table 10.2. Attributes in the sambaSamAccount objectclass (LDAP)  Part B</b></p><table summary="Attributes in the sambaSamAccount objectclass (LDAP)  Part B" border="1"><colgroup><col align="left"><col align="justify"></colgroup><tbody><tr><td align="justify"><tt class="constant">sambaUserWorkstations</tt></td><td align="justify">Here you can give a comma-separated list of machines
				on which the user is allowed to login. You may observe problems when you try to connect to an Samba Domain Member.
				Because Domain Members are not in this list, the Domain Controllers will reject them. Where this attribute is omitted,
				the default implies no restrictions.
				</td></tr><tr><td align="justify"><tt class="constant">sambaSID</tt></td><td align="justify">The security identifier(SID) of the user.
				The Windows equivalent of UNIX UIDs.</td></tr><tr><td align="justify"><tt class="constant">sambaPrimaryGroupSID</tt></td><td align="justify">The Security IDentifier (SID) of the primary group
				of the user.</td></tr><tr><td align="justify"><tt class="constant">sambaDomainName</tt></td><td align="justify">Domain the user is part of.</td></tr></tbody></table></div><p>
			</p><p>
			The majority of these parameters are only used when Samba is acting as a PDC of
			a domain (refer to <a href="samba-pdc.html" title="Chapter 4. Domain Control">Domain Control</a>, for details on
			how to configure Samba as a Primary Domain Controller). The following four attributes
			are only stored with the sambaSamAccount entry if the values are non-default values:
			</p><div class="itemizedlist"><ul type="disc"><li><p>sambaHomePath</p></li><li><p>sambaLogonScript</p></li><li><p>sambaProfilePath</p></li><li><p>sambaHomeDrive</p></li></ul></div><p>
			These attributes are only stored with the sambaSamAccount entry if
			the values are non-default values. For example, assume MORIA has now been
			configured as a PDC and that <a class="indexterm" name="id2554811"></a>logon home = \\%L\%u was defined in
			its <tt class="filename">smb.conf</tt> file. When a user named &#8220;<span class="quote"><span class="emphasis"><em>becky</em></span></span>&#8221; logons to the domain,
			the <a class="indexterm" name="id2554830"></a>logon home string is expanded to \\MORIA\becky.
			If the smbHome attribute exists in the entry &#8220;<span class="quote"><span class="emphasis"><em>uid=becky,ou=People,dc=samba,dc=org</em></span></span>&#8221;,
			this value is used. However, if this attribute does not exist, then the value
			of the <a class="indexterm" name="id2554845"></a>logon home parameter is used in its place. Samba
			will only write the attribute value to the directory entry if the value is
			something other than the default (e.g., <tt class="filename">\\MOBY\becky</tt>).
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2554863"></a>Example LDIF Entries for a sambaSamAccount</h4></div></div></div><p>
			The following is a working LDIF that demonstrates the use of the SambaSamAccount objectclass:
			</p><p>
		
	</p><pre class="programlisting">
	dn: uid=guest2, ou=People,dc=quenya,dc=org
	sambaLMPassword: 878D8014606CDA29677A44EFA1353FC7
	sambaPwdMustChange: 2147483647
	sambaPrimaryGroupSID: S-1-5-21-2447931902-1787058256-3961074038-513
	sambaNTPassword: 552902031BEDE9EFAAD3B435B51404EE
	sambaPwdLastSet: 1010179124
	sambaLogonTime: 0
	objectClass: sambaSamAccount
	uid: guest2
	sambaKickoffTime: 2147483647
	sambaAcctFlags: [UX         ]
	sambaLogoffTime: 2147483647
	sambaSID: S-1-5-21-2447931902-1787058256-3961074038-5006
	sambaPwdCanChange: 0
</pre><p>

	</p><p>
			The following is an LDIF entry for using both the sambaSamAccount and
			posixAccount objectclasses:
			</p><p>
				
	</p><pre class="programlisting">
	dn: uid=gcarter, ou=People,dc=quenya,dc=org
	sambaLogonTime: 0
	displayName: Gerald Carter
	sambaLMPassword: 552902031BEDE9EFAAD3B435B51404EE
	sambaPrimaryGroupSID: S-1-5-21-2447931902-1787058256-3961074038-1201
	objectClass: posixAccount
	objectClass: sambaSamAccount
	sambaAcctFlags: [UX         ]
	userPassword: {crypt}BpM2ej8Rkzogo
	uid: gcarter
	uidNumber: 9000
	cn: Gerald Carter
	loginShell: /bin/bash
	logoffTime: 2147483647
	gidNumber: 100
	sambaKickoffTime: 2147483647
	sambaPwdLastSet: 1010179230
	sambaSID: S-1-5-21-2447931902-1787058256-3961074038-5004
	homeDirectory: /home/moria/gcarter
	sambaPwdCanChange: 0
	sambaPwdMustChange: 2147483647
	sambaNTPassword: 878D8014606CDA29677A44EFA1353FC7
</pre><p>

	</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2554919"></a>Password Synchronization</h4></div></div></div><p>
		Samba-3 and later can update the non-samba (LDAP) password stored with an account. When
		using pam_ldap, this allows changing both UNIX and Windows passwords at once.
		</p><p>The <a class="indexterm" name="id2554934"></a>ldap passwd sync options can have the  values shown in
		<a href="passdb.html#ldappwsync" title="Table 10.3. Possible ldap passwd sync values">the next table</a>.</p><div class="table"><a name="ldappwsync"></a><p class="title"><b>Table 10.3. Possible <span class="emphasis"><em>ldap passwd sync</em></span> values</b></p><table summary="Possible ldap passwd sync values" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">Value</th><th align="center">Description</th></tr></thead><tbody><tr><td align="left">yes</td><td align="justify"><p>When the user changes his password, update
			       <tt class="constant">SambaNTPassword</tt>, <tt class="constant">SambaLMPassword</tt>
			       and the <tt class="constant">password</tt> fields.</p></td></tr><tr><td align="left">no</td><td align="justify"><p>Only update <tt class="constant">SambaNTPassword</tt> and <tt class="constant">SambaLMPassword</tt>.</p></td></tr><tr><td align="left">only</td><td align="justify"><p>Only update the LDAP password and let the LDAP server worry about the other fields.
			This option is only available on some LDAP servers. Only when the LDAP server
			supports LDAP_EXOP_X_MODIFY_PASSWD.</p></td></tr></tbody></table></div><p>More information can be found in the <tt class="filename">smb.conf</tt> man page.</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2555061"></a>MySQL</h3></div></div></div><p>
<a class="indexterm" name="id2555069"></a>
	Every so often someone will come along with a great new idea. Storing user accounts in a
	SQL backend is one of them. Those who want to do this are in the best position to know what the
	specific benefits are to them. This may sound like a cop-out, but in truth we cannot attempt
	to document every little detail why certain things of marginal utility to the bulk of
	Samba users might make sense to the rest. In any case, the following instructions should help
	the determined SQL user to implement a working system.
	</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2555088"></a>Creating the Database</h4></div></div></div><p>
			You can set up your own table and specify the field names to pdb_mysql (see below
			for the column names) or use the default table. The file <tt class="filename">examples/pdb/mysql/mysql.dump</tt> 
			contains the correct queries to create the required tables. Use the command:

</p><pre class="screen">
<tt class="prompt">$ </tt><b class="userinput"><tt>mysql -u<i class="replaceable"><tt>username</tt></i> -h<i class="replaceable"><tt>hostname</tt></i> -p<i class="replaceable"><tt>password</tt></i> \
	<i class="replaceable"><tt>databasename</tt></i> &lt; <tt class="filename">/path/to/samba/examples/pdb/mysql/mysql.dump</tt></tt></b>
</pre><p>
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2555144"></a>Configuring</h4></div></div></div><p>This plug-in lacks some good documentation, but here is some brief information. Add the following to the
			<a class="indexterm" name="id2555154"></a>passdb backend variable in your <tt class="filename">smb.conf</tt>:
</p><table class="simplelist" border="0" summary="Simple list"><tr><td><a class="indexterm" name="id2555172"></a><i class="parameter"><tt>
					
				passdb backend = [other-plugins] mysql:identifier [other-plugins]</tt></i></td></tr></table><p>
			</p><p>The identifier can be any string you like, as long as it does not collide with 
			the identifiers of other plugins or other instances of pdb_mysql. If you 
			specify multiple pdb_mysql.so entries in <a class="indexterm" name="id2555196"></a>passdb backend, you also need to 
			use different identifiers.
			</p><p>
			Additional options can be given through the <tt class="filename">smb.conf</tt> file in the <i class="parameter"><tt>[global]</tt></i> section.
			Refer to <a href="passdb.html#mysqlpbe" title="Table 10.4. Basic smb.conf options for MySQL passdb backend">the following table</a>.
			</p><div class="table"><a name="mysqlpbe"></a><p class="title"><b>Table 10.4. Basic smb.conf options for MySQL passdb backend</b></p><table summary="Basic smb.conf options for MySQL passdb backend" border="1"><colgroup><col align="left"><col align="justify"></colgroup><thead><tr><th align="left">Field</th><th align="justify">Contents</th></tr></thead><tbody><tr><td align="left">mysql host</td><td align="justify">Host name, defaults to `localhost'</td></tr><tr><td align="left">mysql password</td><td align="justify"> </td></tr><tr><td align="left">mysql user</td><td align="justify">Defaults to `samba'</td></tr><tr><td align="left">mysql database</td><td align="justify">Defaults to `samba'</td></tr><tr><td align="left">mysql port</td><td align="justify">Defaults to 3306</td></tr><tr><td align="left">table</td><td align="justify">Name of the table containing the users</td></tr></tbody></table></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
			Since the password for the MySQL user is stored in the <tt class="filename">smb.conf</tt> file, you should make the <tt class="filename">smb.conf</tt> file 
			readable only to the user who runs Samba. This is considered a security bug and will soon be fixed.
			</p></div><p>Names of the columns are given in <a href="passdb.html#moremysqlpdbe" title="Table 10.5. MySQL field names for MySQL passdb backend">the next table</a>. 
			The default column names can be found in the example table dump.
			 </p><p>
			</p><div class="table"><a name="moremysqlpdbe"></a><p class="title"><b>Table 10.5. MySQL field names for MySQL passdb backend</b></p><table summary="MySQL field names for MySQL passdb backend" border="1"><colgroup><col align="left"><col align="left"><col align="justify"></colgroup><thead><tr><th align="justify">Field</th><th align="justify">Type</th><th align="justify">Contents</th></tr></thead><tbody><tr><td align="justify">logon time column</td><td align="justify">int(9)</td><td align="justify">UNIX time stamp of last logon of user</td></tr><tr><td align="justify">logoff time column</td><td align="justify">int(9)</td><td align="justify">UNIX time stamp of last logoff of user</td></tr><tr><td align="justify">kickoff time column</td><td align="justify">int(9)</td><td align="justify">UNIX time stamp of moment user should be kicked off workstation (not enforced)</td></tr><tr><td align="justify">pass last set time column</td><td align="justify">int(9)</td><td align="justify">UNIX time stamp of moment password was last set</td></tr><tr><td align="justify">pass can change time column</td><td align="justify">int(9)</td><td align="justify">UNIX time stamp of moment from which password can be changed</td></tr><tr><td align="justify">pass must change time column</td><td align="justify">int(9)</td><td align="justify">UNIX time stamp of moment on which password must be changed</td></tr><tr><td align="justify">username column</td><td align="justify">varchar(255)</td><td align="justify">UNIX username</td></tr><tr><td align="justify">domain column</td><td align="justify">varchar(255)</td><td align="justify">NT domain user belongs to</td></tr><tr><td align="justify">nt username column</td><td align="justify">varchar(255)</td><td align="justify">NT username</td></tr><tr><td align="justify">fullname column</td><td align="justify">varchar(255)</td><td align="justify">Full name of user</td></tr><tr><td align="justify">home dir column</td><td align="justify">varchar(255)</td><td align="justify">UNIX homedir path (equivalent of the <a class="indexterm" name="id2555509"></a>logon home parameter.</td></tr><tr><td align="justify">dir drive column</td><td align="justify">varchar(2)</td><td align="justify">Directory drive path (e.g., &#8220;<span class="quote"><span class="emphasis"><em>H:</em></span></span>&#8221;)</td></tr><tr><td align="justify">logon script column</td><td align="justify">varchar(255)</td><td align="justify">Batch file to run on client side when logging on</td></tr><tr><td align="justify">profile path column</td><td align="justify">varchar(255)</td><td align="justify">Path of profile</td></tr><tr><td align="justify">acct desc column</td><td align="justify">varchar(255)</td><td align="justify">Some ASCII NT user data</td></tr><tr><td align="justify">workstations column</td><td align="justify">varchar(255)</td><td align="justify">Workstations user can logon to (or NULL for all)</td></tr><tr><td align="justify">unknown string column</td><td align="justify">varchar(255)</td><td align="justify">Unknown string</td></tr><tr><td align="justify">munged dial column</td><td align="justify">varchar(255)</td><td align="justify">Unknown</td></tr><tr><td align="justify">user sid column</td><td align="justify">varchar(255)</td><td align="justify">NT user SID</td></tr><tr><td align="justify">group sid column</td><td align="justify">varchar(255)</td><td align="justify">NT group SID</td></tr><tr><td align="justify">lanman pass column</td><td align="justify">varchar(255)</td><td align="justify">Encrypted lanman password</td></tr><tr><td align="justify">nt pass column</td><td align="justify">varchar(255)</td><td align="justify">Encrypted nt passwd</td></tr><tr><td align="justify">plain pass column</td><td align="justify">varchar(255)</td><td align="justify">Plaintext password</td></tr><tr><td align="justify">acct ctrl column</td><td align="justify">int(9)</td><td align="justify">NT user data</td></tr><tr><td align="justify">unknown 3 column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr><tr><td align="justify">logon divs column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr><tr><td align="justify">hours len column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr><tr><td align="justify">bad password count column</td><td align="justify">int(5)</td><td align="justify">Number of failed password tries before disabling an account</td></tr><tr><td align="justify">logon count column</td><td align="justify">int(5)</td><td align="justify">Number of logon attempts</td></tr><tr><td align="justify">unknown 6 column</td><td align="justify">int(9)</td><td align="justify">Unknown</td></tr></tbody></table></div><p>
		</p><p>
			You can put a colon (:) after the name of each column, which 
			should specify the column to update when updating the table. One can also specify nothing behind the colon, in which case the field data will not be updated. Setting a column name to <i class="parameter"><tt>NULL</tt></i> means the field should not be used.
			</p><p><a href="passdb.html#mysqlsam" title="Example 10.3. Example configuration for the MySQL passdb backend">An example configuration</a> looks like:
			</p><div class="example"><a name="mysqlsam"></a><p class="title"><b>Example 10.3. Example configuration for the MySQL passdb backend</b></p><table class="simplelist" border="0" summary="Simple list"><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td><a class="indexterm" name="id2555757"></a><i class="parameter"><tt>
					
				passdb backend = mysql:foo</tt></i></td></tr><tr><td><a class="indexterm" name="id2555772"></a><i class="parameter"><tt>
					
				foo:mysql user = samba</tt></i></td></tr><tr><td><a class="indexterm" name="id2555788"></a><i class="parameter"><tt>
					
				foo:mysql password = abmas</tt></i></td></tr><tr><td><a class="indexterm" name="id2555804"></a><i class="parameter"><tt>
					
				foo:mysql database = samba</tt></i></td></tr><tr><td># domain name is static and can't be changed</td></tr><tr><td><a class="indexterm" name="id2555826"></a><i class="parameter"><tt>
					
				foo:domain column = 'MYWORKGROUP':</tt></i></td></tr><tr><td># The fullname column comes from several other columns</td></tr><tr><td><a class="indexterm" name="id2555849"></a><i class="parameter"><tt>
					
				foo:fullname column = CONCAT(firstname,' ',surname):</tt></i></td></tr><tr><td># Samba should never write to the password columns</td></tr><tr><td><a class="indexterm" name="id2555872"></a><i class="parameter"><tt>
					
				foo:lanman pass column = lm_pass:</tt></i></td></tr><tr><td><a class="indexterm" name="id2555888"></a><i class="parameter"><tt>
					
				foo:nt pass column = nt_pass:</tt></i></td></tr><tr><td># The unknown 3 column is not stored</td></tr><tr><td><a class="indexterm" name="id2555910"></a><i class="parameter"><tt>
					
				foo:unknown 3 column = NULL</tt></i></td></tr></table></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2555926"></a>Using Plaintext Passwords or Encrypted Password</h4></div></div></div><p>
<a class="indexterm" name="id2555934"></a>
			I strongly discourage the use of plaintext passwords, however, you can use them.
			</p><p>
			If you would like to use plaintext passwords, set
			`identifier:lanman pass column' and `identifier:nt pass column' to
			`NULL' (without the quotes) and `identifier:plain pass column' to the
			name of the column containing the plaintext passwords. 
			</p><p>
			If you use encrypted passwords, set the 'identifier:plain pass
			column' to 'NULL' (without the quotes). This is the default.
			</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="id2555958"></a>Getting Non-Column Data from the Table</h4></div></div></div><p>
			It is possible to have not all data in the database by making some `constant'.
			</p><p>
			For example, you can set `identifier:fullname column' to
			something like <span><b class="command">CONCAT(Firstname,' ',Surname)</b></span>
			</p><p>
			Or, set `identifier:workstations column' to:
			<span><b class="command">NULL</b></span></p><p>See the MySQL documentation for more language constructs.</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="XMLpassdb"></a>XML</h3></div></div></div><p>
<a class="indexterm" name="id2556008"></a>
		This module requires libxml2 to be installed.</p><p>The usage of pdb_xml is fairly straightforward. To export data, use:
		</p><p>
<a class="indexterm" name="id2556026"></a>
			<tt class="prompt">$ </tt> <b class="userinput"><tt>pdbedit -e xml:filename</tt></b>
		</p><p>
		(where filename is the name of the file to put the data in)
		</p><p>
		To import data, use:
		<tt class="prompt">$ </tt> <b class="userinput"><tt>pdbedit -i xml:filename</tt></b>
		</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id2556067"></a>Common Errors</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2556072"></a>Users Cannot Logon</h3></div></div></div><p>&#8220;<span class="quote"><span class="emphasis"><em>I've installed Samba, but now I can't log on with my UNIX account! </em></span></span>&#8221;</p><p>Make sure your user has been added to the current Samba <a class="indexterm" name="id2556088"></a>passdb backend. 
		Read the section <a href="passdb.html#acctmgmttools" title="Account Management Tools">Account Management Tools</a> for details.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2556107"></a>Users Being Added to the Wrong Backend Database</h3></div></div></div><p>
	A few complaints have been received from users that just moved to Samba-3. The following
	<tt class="filename">smb.conf</tt> file entries were causing problems, new accounts were being added to the old
	smbpasswd file, not to the tdbsam passdb.tdb file:
	</p><p>
	</p><table class="simplelist" border="0" summary="Simple list"><tr><td> </td></tr><tr><td><i class="parameter"><tt>[global]</tt></i></td></tr><tr><td>...</td></tr><tr><td><a class="indexterm" name="id2556146"></a><i class="parameter"><tt>
					
				passdb backend = smbpasswd, tdbsam</tt></i></td></tr><tr><td>...</td></tr></table><p>
	</p><p>
	Samba will add new accounts to the first entry in the <span class="emphasis"><em>passdb backend</em></span>
	parameter entry. If you want to update to the tdbsam, then change the entry to:
	</p><p>
</p><table class="simplelist" border="0" summary="Simple list"><tr><td><a class="indexterm" name="id2556183"></a><i class="parameter"><tt>
					
				passdb backend = tdbsam, smbpasswd</tt></i></td></tr></table><p>
	</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="id2556202"></a>Configuration of <i class="parameter"><tt>auth methods</tt></i></h3></div></div></div><p>
	When explicitly setting an <a class="indexterm" name="id2556214"></a>auth methods parameter,
	<i class="parameter"><tt>guest</tt></i> must be specified as the first entry on the line,
	for example, <a class="indexterm" name="id2556229"></a>auth methods = guest sam.
	</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="NetworkBrowsing.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="optional.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="groupmapping.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 9. Network Browsing </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 11. Group Mapping  MS Windows and UNIX</td></tr></table></div></body></html>
